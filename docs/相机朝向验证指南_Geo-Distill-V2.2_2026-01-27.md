# Geo-Distill V2.2 相机朝向验证指南

> **创建时间**: 2026-01-27 12:15:00
> **严重程度**: 🟡 重要检查
> **状态**: 待执行
> **触发原因**: 架构师建议（2026-01-27）

---

## 🎯 验证目的

**为什么需要验证？**
- 四元数 `(w, x, y, z)` 顺序和数值必须100%正确
- 相机装反会导致LiDAR数据错乱（前后颠倒）
- Isaac Sim GUI 可以直观确认相机视野

**验证时机**：
- ✅ 代码修改后
- ✅ 首次训练前
- ✅ 发现机器人行为异常时

---

## 🔍 验证步骤

### 步骤1：启动 Isaac Sim GUI

```bash
# 方法1：使用项目训练脚本（自动加载环境）
cd ~/dashgo_rl_project
python train_v2.py --num_envs 1

# 方法2：手动启动 Isaac Sim
~/IsaacLab/isaaclab.sh --editor
```

### 步骤2：打开 Stage（场景）

1. 在 Isaac Sim 左侧 **Stage** 栏
2. 找到 `/World/Default_0/Dashgo/base_link/`
3. 展开查看4个相机：
   - `cam_front`
   - `cam_left`
   - `cam_back`
   - `cam_right`

### 步骤3：逐个检查相机视野

#### 3.1 前向相机 (cam_front, 0°)

**检查项**：
- [ ] 视野朝前（机器人的正前方）
- [ ] 能看到前方的障碍物（红色圆柱/方块）
- [ ] FOV 约 90°（左右各45°）

**验证方法**：
1. 右键点击 `cam_front` → **Inspect**
2. 在 **Viewport** 中选择相机视角
3. 检查视野是否正确

**预期结果**：
```
   机器人朝向
      ↑
      | (能看到前方障碍物)
   [cam_front]
```

#### 3.2 左侧相机 (cam_left, +90°)

**检查项**：
- [ ] 视野朝左（机器人的左侧）
- [ ] 能看到左侧的障碍物
- [ ] FOV 约 90°

**预期结果**：
```
      (能看到左侧障碍物)
      ←
   [cam_left]
```

#### 3.3 后向相机 (cam_back, 180°)

**检查项**：
- [ ] 视野朝后（机器人的正后方）
- [ ] 能看到后方的障碍物
- [ ] FOV 约 90°

**预期结果**：
```
   [cam_back]
      ↓
      | (能看到后方障碍物)
```

#### 3.4 右侧相机 (cam_right, -90°)

**检查项**：
- [ ] 视野朝右（机器人的右侧）
- [ ] 能看到右侧的障碍物
- [ ] FOV 约 90°

**预期结果**：
```
            (能看到右侧障碍物)
            →
   [cam_right]
```

---

## ✅ 验证清单

完成检查后，确认以下4项：

- [ ] **Front (0°)**：视野朝前，能看到前方障碍物
- [ ] **Left (+90°)**：视野朝左，能看到左侧障碍物
- [ ] **Back (180°)**：视野朝后，能看到后方障碍物
- [ ] **Right (-90°)**：视野朝右，能看到右侧障碍物

**如果任何一项不通过**：
1. 检查 `dashgo_env_v2.py` 中的 `rot` 参数
2. 确认四元数顺序是 `(w, x, y, z)`
3. 参考下文的"四元数计算公式"修正

---

## 📐 四元数计算公式

### Isaac Sim 四元数规范

**格式**：`(w, x, y, z)`
- `w`: cos(θ/2) - 实部
- `x, y, z`: sin(θ/2) * axis - 虚部（旋转轴向量）

### 4个相机的四元数

| 相机 | 旋转角度 | 计算公式 | 四元数 (w, x, y, z) |
|------|---------|---------|---------------------|
| **Front** | 0° | (cos0°, 0, 0, sin0°) | (1.0, 0.0, 0.0, 0.0) |
| **Left** | +90° | (cos45°, 0, 0, sin45°) | (0.707, 0.0, 0.0, 0.707) |
| **Back** | 180° | (cos90°, 0, 0, sin90°) | (0.0, 0.0, 1.0, 0.0) |
| **Right** | -90° | (cos(-45°), 0, 0, sin(-45°)) | (0.707, 0.0, 0.0, -0.707) |

### 旋转方向说明

**逆时针（右手定则）**：
- 拇指朝上（Z轴正方向）
- 四指卷曲方向 = 旋转方向

**示例**：
- 从前向左转90°：+90°（逆时针）
- 从前向右转90°：-90°（顺时针）

---

## 🐛 常见问题排查

### 问题1：相机视野是黑屏

**原因**：相机被障碍物遮挡
**解决**：
1. 检查 `prim_path` 是否正确
2. 检查 `pos` 安装位置是否太低

### 问题2：相机视野颠倒

**原因**：四元数装反了
**解决**：
1. 检查 `rot` 顺序是否为 `(w, x, y, z)`
2. 使用上述公式重新计算

### 问题3：相机FOV不对（太宽/太窄）

**原因**：`horizontal_aperture` 参数错误
**解决**：
- 90° FOV 对应 `horizontal_aperture=20.955`
- 不要手动调整此参数

---

## 📝 验证记录

### 验证人：___________  日期：___________

**Front (0°)**：通过 ⬜ 不通过 ⬜
**Left (+90°)**：通过 ⬜ 不通过 ⬜
**Back (180°)**：通过 ⬜ 不通过 ⬜
**Right (-90°)**：通过 ⬜ 不通过 ⬜

**备注**：
_________________________________________________
_________________________________________________
_________________________________________________

---

**维护者**: Claude Code AI System (Robot-Nav-Architect Agent)
**项目**: DashGo机器人导航（Sim2Real）
**开发基准**: Isaac Sim 4.5 + Ubuntu 20.04
**状态**: 🟡 待验证
