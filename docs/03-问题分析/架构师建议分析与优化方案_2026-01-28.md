# æ¶æ„å¸ˆå»ºè®®åˆ†æä¸æœ¬åœ°é¡¹ç›®ä¼˜åŒ–æ–¹æ¡ˆ

> **åˆ›å»ºæ—¶é—´**: 2026-01-28 15:45:30
> **åˆ†æå¯¹è±¡**: Isaac Simæ¶æ„å¸ˆçš„"ç»ˆæä¿®æ­£æ–¹æ¡ˆ"å»ºè®®
> **åˆ†æç›®çš„**: å¯¹ç…§æœ¬åœ°é¡¹ç›®ç°çŠ¶ï¼Œé’ˆå¯¹æ€§æ¢è®¨æ”¹è¿›æ–¹æ¡ˆ
> **æ‰§è¡ŒçŠ¶æ€**: âš ï¸ ä»…åˆ†æï¼Œä¸æ‰§è¡Œä»£ç ä¿®æ”¹

---

## ğŸ“Š æ¶æ„å¸ˆè¯„ä»·å›é¡¾

æ¶æ„å¸ˆå¯¹ã€Šä»£ç æ¥å£å¯¹åº”å…³ç³»æ£€æŸ¥æŠ¥å‘Šã€‹çš„æ·±åº¦è¯„ä»·ï¼š

| é—®é¢˜ç¼–å· | æŠ¥å‘Šè¯„çº§ | æ¶æ„å¸ˆè¯„çº§ | å…³é”®è¯„ä»· |
|---------|---------|-----------|---------|
| **#4 è§‚æµ‹ç»´åº¦** | ğŸ”´ é«˜ | ğŸ’€ è‡´å‘½ | "ç¥ç»ç½‘ç»œåƒä¹±ç ï¼Œæœºå™¨äººä¼šåƒå‘ç–¯ä¸€æ ·éšæœºæ’å¢™ã€‚å¿…é¡»åŠ Assertæ–­è¨€ï¼" |
| **#8 åŠ é€Ÿåº¦é™åˆ¶** | ğŸŸ¡ ä¸­ | ğŸ”´ é«˜å± | "2.0 rad/sÂ²ä¼šè®©DashGoç›´æ¥ç”©å°¾ç”šè‡³ç¿»è½¦" |
| **#7 æ§åˆ¶é¢‘ç‡** | ğŸŸ¡ ä¸­ | ğŸ”´ é«˜å± | "æŒ‡ä»¤å †ç§¯ï¼Œååº”æ…¢0.5ç§’ä»¥ä¸Šï¼Œå¯¼è‡´åˆ¹ä¸ä½è½¦" |
| **#5 LiDARé™é‡‡æ ·** | ğŸŸ¡ ä¸­ | ğŸŸ¢ å·²è§£ | "ä¸Šä¸€è½®é€šè¿‡Min-Poolingå·²è§£å†³" |

**æ¶æ„å¸ˆæ€»ç»“**ï¼šæŠ¥å‘Šä»·å€¼è¿åŸï¼Œé¿å…äº†è‡³å°‘3æ¬¡å®è½¦ç¢°æ’äº‹æ•…ã€‚

---

## ğŸ” å…³é”®å·®å¼‚å¯¹æ¯”åˆ†æ

### å·®å¼‚1: æ¨ç†å¼•æ“é€‰æ‹©

#### æ¶æ„å¸ˆå»ºè®®
```python
# ä½¿ç”¨ONNX Runtimeæ¨ç†
import onnxruntime as ort
self.ort_session = ort.InferenceSession(model_path)
action = self.ort_session.run(None, inputs)[0][0]
```

#### æœ¬åœ°é¡¹ç›®ç°çŠ¶
```python
# ä½¿ç”¨PyTorch TorchScriptæ¨ç†
import torch
self.model = torch.jit.load(self.model_path, map_location=self.device)
with torch.no_grad():
    action = self.model(input_tensor).cpu().numpy()[0]
```

**åˆ†æ**ï¼š
| å¯¹æ¯”é¡¹ | ONNX Runtime | PyTorch TorchScript |
|-------|-------------|---------------------|
| **éƒ¨ç½²å¤æ‚åº¦** | âœ… ä½ï¼ˆpip install onnxruntimeï¼‰ | âš ï¸ ä¸­ï¼ˆéœ€è¦å®Œæ•´PyTorchï¼‰ |
| **CPUæ¨ç†æ€§èƒ½** | âœ… ä¼˜åŒ–å¥½ | âš ï¸ ä¸€èˆ¬ |
| **GPUæ¨ç†æ€§èƒ½** | âš ï¸ ä¸€èˆ¬ | âœ… å¥½ |
| **è°ƒè¯•ä¾¿åˆ©æ€§** | âŒ å·® | âœ… å¥½ |
| **æ¨¡å‹å…¼å®¹æ€§** | âš ï¸ éœ€è¦è½¬æ¢ | âœ… è®­ç»ƒéƒ¨ç½²åŒä¸€æ ¼å¼ |
| **æœ¬åœ°ç°çŠ¶** | âŒ éœ€è¦é‡æ–°å¯¼å‡ºæ¨¡å‹ | âœ… å·²æœ‰TorchScriptæ¨¡å‹ |

**ç»“è®º**ï¼š
- âœ… **ä¿æŒPyTorch**ï¼šå› ä¸ºå·²æœ‰TorchScriptæ¨¡å‹ï¼Œä¸”è®­ç»ƒç¯å¢ƒä¸€è‡´
- âœ… å¦‚æœæœªæ¥éœ€è¦ä¼˜åŒ–éƒ¨ç½²æ€§èƒ½ï¼Œå¯ä»¥è€ƒè™‘ONNX

---

### å·®å¼‚2: å†å²ç¼“å†²åŒºå®ç°

#### æ¶æ„å¸ˆå»ºè®®
```python
# ä½¿ç”¨numpy.roll()å®ç°FIFO
self.obs_buffer = np.zeros((self.history_len, self.single_obs_dim), dtype=np.float32)
# æ›´æ–°
self.obs_buffer = np.roll(self.obs_buffer, -1, axis=0)
self.obs_buffer[-1] = current_obs
```

#### æœ¬åœ°é¡¹ç›®ç°çŠ¶
```python
# ä½¿ç”¨collections.dequeå®ç°FIFO
class ObservationBuffer:
    def __init__(self, history_len=3, obs_dim=82):
        self.buffer = collections.deque(maxlen=history_len)
        for _ in range(history_len):
            self.buffer.append(np.zeros(obs_dim, dtype=np.float32))

    def update(self, current_obs):
        self.buffer.append(current_obs)

    def get_stacked_obs(self):
        stacked = np.concatenate(list(self.buffer))
        return torch.tensor(stacked, dtype=torch.float32).unsqueeze(0)
```

**æ€§èƒ½å¯¹æ¯”**ï¼š
| å®ç°æ–¹å¼ | æ—¶é—´å¤æ‚åº¦ | ç©ºé—´å¤æ‚åº¦ | å†…å­˜æ•ˆç‡ | ä»£ç å¯è¯»æ€§ |
|---------|----------|----------|---------|-----------|
| `np.roll()` | O(n) | O(n) | âš ï¸ ä½ï¼ˆéœ€è¦å¤åˆ¶æ•´ä¸ªæ•°ç»„ï¼‰ | âœ… ç®€æ´ |
| `deque` | O(1) | O(n) | âœ… é«˜ï¼ˆæŒ‡é’ˆç§»åŠ¨ï¼‰ | âœ… æ¸…æ™° |

**ç»“è®º**ï¼š
- âœ… **ä¿æŒdequeå®ç°**ï¼šæ€§èƒ½æ›´å¥½ï¼Œä»£ç æ›´æ¸…æ™°
- âœ… æœ¬åœ°é¡¹ç›®çš„ObservationBufferç±»å°è£…è‰¯å¥½

---

### å·®å¼‚3: é€Ÿåº¦è§‚æµ‹ç»´åº¦å¤„ç†

#### æ¶æ„å¸ˆå»ºè®®
```python
# æ˜ç¡®åªå–æœ‰ç”¨çš„ç»´åº¦
lin_vel_obs = np.array([self.current_vel[0], 0.0, 0.0], dtype=np.float32)  # åªå–x
ang_vel_obs = np.array([0.0, 0.0, self.current_vel[1]], dtype=np.float32)  # åªå–z
```

#### æœ¬åœ°é¡¹ç›®ç°çŠ¶
```python
# ä»odomè¯»å–6ç»´ï¼Œä½¿ç”¨æ—¶åˆ‡ç‰‡
self.current_vel = np.zeros(6, dtype=np.float32)  # [vx, vy, vz, wx, wy, wz]
# åœ¨odom_cbä¸­å¡«å……
self.current_vel[0] = msg.twist.twist.linear.x
self.current_vel[1] = msg.twist.twist.linear.y
# ...
# ä½¿ç”¨æ—¶
self.current_vel[:3]  # Lin Vel
self.current_vel[3:]  # Ang Vel
```

**åˆ†æ**ï¼š
- âœ… **æœ¬åœ°é¡¹ç›®æ–¹æ³•æ›´é€šç”¨**ï¼šå¯ä»¥é€‚åº”3Då¯¼èˆªåœºæ™¯
- âœ… **æ¶æ„å¸ˆå»ºè®®æ›´æ˜ç¡®**ï¼šå¹³é¢å¯¼èˆªç¡®å®åªéœ€è¦xå’Œz
- ğŸ“Š ç»´åº¦ä¸€è‡´æ€§ï¼šä¸¤ç§æ–¹æ³•æœ€ç»ˆè¾“å…¥éƒ½æ˜¯82ç»´ï¼Œæ— å½±å“

**ç»“è®º**ï¼š
- âœ… **ä¿æŒæœ¬åœ°é¡¹ç›®æ–¹æ³•**ï¼šæ›´é€šç”¨ï¼Œä¸”ç»´åº¦å·²ç»å¯¹é½
- ğŸ’¡ **å¯ä¼˜åŒ–**ï¼šæ·»åŠ æ³¨é‡Šè¯´æ˜å¹³é¢å¯¼èˆªåªéœ€è¦éƒ¨åˆ†ç»´åº¦

---

### å·®å¼‚4: æ§åˆ¶é¢‘ç‡åŠ¨æ€åŒ– âš ï¸ å…³é”®æ”¹è¿›

#### æ¶æ„å¸ˆå»ºè®®
```python
# ä»launchæ–‡ä»¶è¯»å–ï¼ŒåŠ¨æ€è®¡ç®—dt
self.control_rate = rospy.get_param('~control_rate', 20)
self.dt = 1.0 / self.control_rate
self.timer = rospy.Timer(rospy.Duration(self.dt), self.control_loop)
```

#### æœ¬åœ°é¡¹ç›®ç°çŠ¶
```python
# ç¡¬ç¼–ç 20Hz
rospy.Timer(rospy.Duration(0.05), self.control_loop)
```

**é—®é¢˜åˆ†æ**ï¼š
- âŒ **æœ¬åœ°é¡¹ç›®**ï¼šä¿®æ”¹launchæ–‡ä»¶çš„control_rateå‚æ•°æ— æ•ˆ
- âŒ **é…ç½®ä¸ä¸€è‡´**ï¼šä»£ç å’Œé…ç½®æ–‡ä»¶å¯èƒ½ä¸ä¸€è‡´

**ç»“è®º**ï¼š
- ğŸ”´ **å¿…é¡»é‡‡çº³æ¶æ„å¸ˆå»ºè®®**ï¼šè¿™æ˜¯æ˜æ˜¾çš„bug
- ğŸ“ ä¿®å¤ä¼˜å…ˆçº§ï¼šé«˜

---

### å·®å¼‚5: åŠ é€Ÿåº¦é™åˆ¶æ•°å­¦ä¿®æ­£ âš ï¸ å…³é”®æ”¹è¿›

#### æ¶æ„å¸ˆå»ºè®®
```python
# ä»launchè¯»å–ç‰©ç†åŠ é€Ÿåº¦é™åˆ¶
self.max_acc_lin = rospy.get_param('~max_lin_acc', 1.0)  # m/sÂ²
self.max_acc_ang = rospy.get_param('~max_ang_acc', 0.6)  # rad/sÂ²

# æ¯å‘¨æœŸé™åˆ¶ï¼ˆæ­£ç¡®è®¡ç®—ï¼‰
acc_lin_per_tick = self.max_acc_lin * self.dt
acc_ang_per_tick = self.max_acc_ang * self.dt

# ä½¿ç”¨
cmd_v = np.clip(cmd_v, last_cmd_v - acc_lin_per_tick, last_cmd_v + acc_lin_per_tick)
```

#### æœ¬åœ°é¡¹ç›®ç°çŠ¶
```python
# ç¡¬ç¼–ç æ¯å‘¨æœŸé™åˆ¶
MAX_ACCEL_LIN = 0.05  # m/sÂ² per control cycle at 20Hz
MAX_ACCEL_ANG = 0.1   # rad/sÂ² per control cycle

# ç›´æ¥ä½¿ç”¨
cmd_v = np.clip(cmd_v, last_cmd_v - MAX_ACCEL_LIN, last_cmd_v + MAX_ACCEL_LIN)
```

**æ•°å­¦éªŒè¯**ï¼š
```
æ¶æ„å¸ˆæ–¹æ³•ï¼š
  1.0 m/sÂ² * (1/20) = 0.05 m/s per tick âœ…
  0.6 rad/sÂ² * (1/20) = 0.03 rad/s per tick âœ…

æœ¬åœ°é¡¹ç›®ï¼š
  0.05 m/s per tick * 20Hz = 1.0 m/sÂ² âœ…
  0.1 rad/s per tick * 20Hz = 2.0 rad/sÂ² âŒ è¶…è¿‡é…ç½®(0.6)
```

**ç»“è®º**ï¼š
- ğŸ”´ **å¿…é¡»ä¿®æ­£è§’åŠ é€Ÿåº¦**ï¼šæœ¬åœ°é¡¹ç›®çš„0.1è¶…è¿‡äº†ç‰©ç†é™åˆ¶
- ğŸ”´ **å¿…é¡»é‡‡çº³åŠ¨æ€è®¡ç®—**ï¼šå¦åˆ™ä¿®æ”¹é¢‘ç‡ä¼šå¯¼è‡´é™åˆ¶é”™è¯¯

---

### å·®å¼‚6: æ¨¡å‹åŠ è½½æ—¶çš„ç»´åº¦æ£€æŸ¥ âš ï¸ å…³é”®æ”¹è¿›

#### æ¶æ„å¸ˆå»ºè®®
```python
# åŠ è½½åç«‹å³æ£€æŸ¥ç»´åº¦
if model_path.endswith('.onnx'):
    self.ort_session = ort.InferenceSession(model_path)
    expected_shape = self.ort_session.get_inputs()[0].shape
    if expected_shape[1] != self.total_input_dim:
        rospy.logerr(f"ğŸ’€ ç»´åº¦ä¸åŒ¹é…ï¼Œæ¨¡å‹æœŸæœ› {expected_shape[1]} ä½†ä»£ç è®¡ç®—ä¸º {self.total_input_dim}")
        rospy.signal_shutdown("Dimension Mismatch")
```

#### æœ¬åœ°é¡¹ç›®ç°çŠ¶
```python
# æ²¡æœ‰æ˜¾å¼çš„ç»´åº¦æ£€æŸ¥
self.model = torch.jit.load(self.model_path, map_location=self.device)
# ç›´æ¥ä½¿ç”¨ï¼Œå¦‚æœä¸åŒ¹é…ä¼šåœ¨æ¨ç†æ—¶æŠ¥é”™
```

**é—®é¢˜åˆ†æ**ï¼š
- âŒ **é”™è¯¯æ—¶æœº**ï¼šå¦‚æœç»´åº¦ä¸åŒ¹é…ï¼Œä¼šåœ¨ç¬¬ä¸€æ¬¡æ¨ç†æ—¶æ‰æŠ¥é”™
- âŒ **é”™è¯¯ä¿¡æ¯ä¸æ˜ç¡®**ï¼štorch.jitçš„é”™è¯¯ä¿¡æ¯å¯èƒ½å¾ˆéš¾ç†è§£
- âŒ **å¯åŠ¨æ—¶é—´æµªè´¹**ï¼šå¯åŠ¨åç­‰åˆ°ç¬¬ä¸€æ¬¡æ¨ç†æ‰å‘ç°é—®é¢˜

**ç»“è®º**ï¼š
- ğŸ”´ **å¿…é¡»é‡‡çº³**ï¼šè¿™æ˜¯"è‡´å‘½é—®é¢˜"çš„é˜²æŠ¤æªæ–½
- ğŸ“ ä¿®å¤ä¼˜å…ˆçº§ï¼šæœ€é«˜

---

### å·®å¼‚7: è¯é¢˜åç§°ä¸remap

#### æ¶æ„å¸ˆå»ºè®®
```python
# å‘å¸ƒåˆ°ä¸“ç”¨è¯é¢˜ï¼Œé€šè¿‡remapæ˜ å°„
self.pub_cmd = rospy.Publisher('/cmd_vel_rl', Twist, queue_size=1)

# launchæ–‡ä»¶ä¸­
<remap from="/cmd_vel" to="/cmd_vel_rl"/>
```

#### æœ¬åœ°é¡¹ç›®ç°çŠ¶
```python
# ç›´æ¥å‘å¸ƒåˆ°/cmd_vel
self.pub_cmd = rospy.Publisher('/cmd_vel', Twist, queue_size=1)
```

**åˆ†æ**ï¼š
- âœ… **æ¶æ„å¸ˆå»ºè®®çš„ä¼˜åŠ¿**ï¼š
  - å¯ä»¥é…åˆtwist_muxå®ç°å¤šæºæ§åˆ¶ä¼˜å…ˆçº§
  - ä¾¿äºè°ƒè¯•ï¼ˆå¯ä»¥åˆ‡æ¢æ‰‹åŠ¨/è‡ªåŠ¨ï¼‰
  - æ›´å®‰å…¨ï¼ˆå¯ä»¥æ·»åŠ ç´§æ€¥åœæ­¢ï¼‰

- âš ï¸ **æœ¬åœ°é¡¹ç›®çš„è€ƒè™‘**ï¼š
  - ç›®å‰æ²¡æœ‰ä½¿ç”¨twist_mux
  - ç›´æ¥å‘å¸ƒæ›´ç®€å•

**ç»“è®º**ï¼š
- ğŸ’¡ **å»ºè®®é‡‡çº³**ï¼šä¸ºæœªæ¥æ‰©å±•æ€§è€ƒè™‘
- ğŸ“ ä¼˜å…ˆçº§ï¼šä¸­ï¼ˆå¯ä»¥åç»­ä¼˜åŒ–ï¼‰

---

### å·®å¼‚8: æ¨¡å‹è·¯å¾„æŸ¥æ‰¾

#### æ¶æ„å¸ˆå»ºè®®
```python
import rospkg
# ä½¿ç”¨rospkgåŠ¨æ€æŸ¥æ‰¾åŒ…è·¯å¾„
default_model_path = os.path.join(
    rospkg.RosPack().get_path('dashgo_rl'), 'models/policy_torchscript.pt'
)
model_path = rospy.get_param('~model_path', default_model_path)
```

#### æœ¬åœ°é¡¹ç›®ç°çŠ¶
```python
# ç¡¬ç¼–ç ç›¸å¯¹è·¯å¾„
self.model_path = rospy.get_param('~model_path', '../models/policy_torchscript.pt')
```

**é—®é¢˜åˆ†æ**ï¼š
- âŒ **ç›¸å¯¹è·¯å¾„ä¸å¯é **ï¼šå–å†³äºè¿è¡Œç›®å½•
- âŒ **è·¨å¹³å°é—®é¢˜**ï¼šä¸åŒæ“ä½œç³»ç»Ÿè·¯å¾„å¯èƒ½ä¸åŒ

**ç»“è®º**ï¼š
- ğŸ”´ **å¿…é¡»é‡‡çº³**ï¼šé¿å…è·¯å¾„æ‰¾ä¸åˆ°çš„é—®é¢˜
- ğŸ“ ä¿®å¤ä¼˜å…ˆçº§ï¼šé«˜

---

## ğŸ¯ æœ¬åœ°é¡¹ç›®ä¼˜åŒ–æ–¹æ¡ˆ

### æ–¹æ¡ˆæ¦‚è¿°

**æ ¸å¿ƒåŸåˆ™**ï¼š
1. âœ… ä¿æŒPyTorchæ¨ç†å¼•æ“ï¼ˆå·²æœ‰æ¨¡å‹ï¼Œè®­ç»ƒä¸€è‡´ï¼‰
2. âœ… ä¿æŒdequeå®ç°ï¼ˆæ€§èƒ½æ›´å¥½ï¼‰
3. ğŸ”´ é‡‡çº³æ¶æ„å¸ˆçš„æ‰€æœ‰å®‰å…¨æ€§æ”¹è¿›ï¼ˆç»´åº¦æ£€æŸ¥ã€åŠ¨æ€å‚æ•°ã€æ•°å­¦ä¿®æ­£ï¼‰
4. ğŸ’¡ éƒ¨åˆ†é‡‡çº³æ¶æ„å¸ˆçš„å¯æ‰©å±•æ€§å»ºè®®ï¼ˆè¯é¢˜remapã€rospkgï¼‰

---

### å¿…é¡»ä¿®æ”¹çš„é—®é¢˜ï¼ˆğŸ”´ é«˜ä¼˜å…ˆçº§ï¼‰

#### ä¿®æ”¹1: æ·»åŠ ç»´åº¦ç†”æ–­æ£€æŸ¥
**é—®é¢˜ç¼–å·**ï¼šæŠ¥å‘Š #4
**æ¶æ„å¸ˆè¯„çº§**ï¼šğŸ’€ è‡´å‘½

**å®æ–½æ–¹æ¡ˆ**ï¼š
```python
# åœ¨__init__çš„æ¨¡å‹åŠ è½½éƒ¨åˆ†æ·»åŠ 
self.model = torch.jit.load(self.model_path, map_location=self.device)
self.model.eval()

# ğŸ”¥ æ–°å¢ï¼šç»´åº¦æ£€æŸ¥
try:
    dummy_input = torch.randn(1, self.total_input_dim).to(self.device)
    dummy_output = self.model(dummy_input)
    rospy.loginfo(f"âœ… ç»´åº¦æ£€æŸ¥é€šè¿‡ï¼šè¾“å…¥{dummy_input.shape} â†’ è¾“å‡º{dummy_output.shape}")
except Exception as e:
    rospy.logerr(f"ğŸ’€ è‡´å‘½é”™è¯¯ï¼šæ¨¡å‹ç»´åº¦ä¸åŒ¹é…ï¼")
    rospy.logerr(f"   æ¨¡å‹æœŸæœ›è¾“å…¥ï¼š{self.total_input_dim}ç»´")
    rospy.logerr(f"   é”™è¯¯ä¿¡æ¯ï¼š{e}")
    rospy.signal_shutdown("Dimension Mismatch")
    exit(1)
```

---

#### ä¿®æ”¹2: åŠ¨æ€æ§åˆ¶é¢‘ç‡
**é—®é¢˜ç¼–å·**ï¼šæŠ¥å‘Š #2
**æ¶æ„å¸ˆè¯„çº§**ï¼šğŸ”´ é«˜å±ï¼ˆæŒ‡ä»¤å †ç§¯ï¼‰

**å®æ–½æ–¹æ¡ˆ**ï¼š
```python
# åœ¨__init__ä¸­æ·»åŠ 
self.control_rate = rospy.get_param('~control_rate', 20)
self.dt = 1.0 / self.control_rate

# ä¿®æ”¹Timeråˆ›å»º
self.timer = rospy.Timer(rospy.Duration(self.dt), self.control_loop)

# ä¿®æ”¹åŠ é€Ÿåº¦é™åˆ¶è®¡ç®—ï¼ˆè§ä¿®æ”¹3ï¼‰
```

---

#### ä¿®æ”¹3: åŠ é€Ÿåº¦é™åˆ¶æ•°å­¦ä¿®æ­£
**é—®é¢˜ç¼–å·**ï¼šæŠ¥å‘Š #8
**æ¶æ„å¸ˆè¯„çº§**ï¼šğŸ”´ é«˜å±ï¼ˆç”©å°¾ç¿»è½¦ï¼‰

**å®æ–½æ–¹æ¡ˆ**ï¼š
```python
# åœ¨__init__ä¸­æ·»åŠ 
self.max_acc_lin = rospy.get_param('~max_lin_acc', 1.0)
self.max_acc_ang = rospy.get_param('~max_ang_acc', 0.6)

# åœ¨control_loopä¸­ä¿®æ”¹åŠ é€Ÿåº¦é™åˆ¶ï¼ˆæ›¿æ¢ç¡¬ç¼–ç çš„0.05å’Œ0.1ï¼‰
# è®¡ç®—æ¯å‘¨æœŸçš„åŠ é€Ÿåº¦é™åˆ¶
acc_lin_per_tick = self.max_acc_lin * self.dt
acc_ang_per_tick = self.max_acc_ang * self.dt

# ä½¿ç”¨åŠ¨æ€å€¼æ›¿æ¢ç¡¬ç¼–ç 
cmd_v = np.clip(cmd_v, last_cmd_v - acc_lin_per_tick, last_cmd_v + acc_lin_per_tick)
cmd_w = np.clip(cmd_w, last_cmd_w - acc_ang_per_tick, last_cmd_w + acc_ang_per_tick)
```

---

#### ä¿®æ”¹4: æ¨¡å‹è·¯å¾„ä¼˜åŒ–
**é—®é¢˜ç¼–å·**ï¼šæŠ¥å‘Š #3
**æ¶æ„å¸ˆè¯„çº§**ï¼šğŸŸ¡ ä¸­

**å®æ–½æ–¹æ¡ˆ**ï¼š
```python
import rospkg

# åœ¨__init__ä¸­ä¿®æ”¹
try:
    default_model_path = os.path.join(
        rospkg.RosPack().get_path('dashgo_rl'),
        'models/policy_torchscript.pt'
    )
except rospkg.ResourceNotFound:
    # Fallbackåˆ°ç›¸å¯¹è·¯å¾„
    default_model_path = '../models/policy_torchscript.pt'
    rospy.logwarn(f"âš ï¸ æœªæ‰¾åˆ°dashgo_rlåŒ…ï¼Œä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼š{default_model_path}")

self.model_path = rospy.get_param('~model_path', default_model_path)
```

---

### å¯é€‰ä¿®æ”¹çš„é—®é¢˜ï¼ˆğŸŸ¡ ä¸­ä¼˜å…ˆçº§ï¼‰

#### å¯é€‰1: RVizé…ç½®æ–‡ä»¶
**é—®é¢˜ç¼–å·**ï¼šæŠ¥å‘Š #1
**æ¶æ„å¸ˆè¯„çº§**ï¼šğŸŸ¡ ä¸­

**å®æ–½æ–¹æ¡ˆ**ï¼š
```bash
# åˆ›å»ºç›®å½•å’Œç©ºé…ç½®æ–‡ä»¶
mkdir -p catkin_ws/src/dashgo_rl/rviz
touch catkin_ws/src/dashgo_rl/rviz/nav_real.rviz
touch catkin_ws/src/dashgo_rl/rviz/nav.rviz
```

**è¯´æ˜**ï¼š
- ç©ºé…ç½®æ–‡ä»¶ä¼šå¯¼è‡´Rvizä½¿ç”¨é»˜è®¤é…ç½®
- åç»­å¯ä»¥åœ¨Rvizä¸­æ‰‹åŠ¨é…ç½®å¹¶ä¿å­˜
- æˆ–ä»ç±»ä¼¼é¡¹ç›®å¤åˆ¶é…ç½®æ–‡ä»¶

---

#### å¯é€‰2: è¯é¢˜remapï¼ˆä¸ºtwist_muxåšå‡†å¤‡ï¼‰
**é—®é¢˜ç¼–å·**ï¼šæ–°å¢
**æ¶æ„å¸ˆå»ºè®®**ï¼šé…åˆtwist_muxå®ç°å¤šæºæ§åˆ¶

**å®æ–½æ–¹æ¡ˆ**ï¼š
```python
# å‘å¸ƒåˆ°ä¸“ç”¨è¯é¢˜
self.pub_cmd = rospy.Publisher('/cmd_vel_rl', Twist, queue_size=1)
```

**launchæ–‡ä»¶ä¿®æ”¹**ï¼š
```xml
<!-- æ·»åŠ remap -->
<remap from="/cmd_vel" to="/cmd_vel_rl"/>
```

**è¯´æ˜**ï¼š
- å½“å‰ä¸ä½¿ç”¨twist_muxæ—¶ï¼Œremapä¼šå°†/cmd_velæ˜ å°„åˆ°/cmd_vel_rl
- æœªæ¥ä½¿ç”¨twist_muxæ—¶ï¼Œå¯ä»¥å®ç°å¤šæºæ§åˆ¶ä¼˜å…ˆçº§
- **ä¸å½±å“å½“å‰åŠŸèƒ½**

---

## ğŸ“‹ ä¿®æ”¹ä¼˜å…ˆçº§æ€»ç»“

### ğŸ”´ ç¬¬ä¸€ä¼˜å…ˆçº§ï¼ˆå¿…é¡»ç«‹å³ä¿®æ”¹ï¼‰
1. âœ… **ç»´åº¦ç†”æ–­æ£€æŸ¥**ï¼ˆæŠ¥å‘Š#4ï¼‰- é˜²æ­¢"ç¥ç»ç½‘ç»œåƒä¹±ç "
2. âœ… **åŠ¨æ€æ§åˆ¶é¢‘ç‡**ï¼ˆæŠ¥å‘Š#2ï¼‰- é˜²æ­¢"æŒ‡ä»¤å †ç§¯åˆ¹ä¸ä½è½¦"
3. âœ… **åŠ é€Ÿåº¦æ•°å­¦ä¿®æ­£**ï¼ˆæŠ¥å‘Š#8ï¼‰- é˜²æ­¢"ç”©å°¾ç¿»è½¦"
4. âœ… **æ¨¡å‹è·¯å¾„ä¼˜åŒ–**ï¼ˆæŠ¥å‘Š#3ï¼‰- é˜²æ­¢"æ¨¡å‹æ‰¾ä¸åˆ°"

### ğŸŸ¡ ç¬¬äºŒä¼˜å…ˆçº§ï¼ˆå»ºè®®ä¿®æ”¹ï¼‰
5. ğŸ’¡ **RVizé…ç½®æ–‡ä»¶**ï¼ˆæŠ¥å‘Š#1ï¼‰- æå‡ç”¨æˆ·ä½“éªŒ
6. ğŸ’¡ **è¯é¢˜remap**ï¼ˆæ–°å¢ï¼‰- ä¸ºæœªæ¥æ‰©å±•åšå‡†å¤‡

### ğŸŸ¢ ä¿æŒä¸å˜ï¼ˆå·²ç»æ­£ç¡®ï¼‰
7. âœ… **PyTorchæ¨ç†** - æ¯”ONNXæ›´é€‚åˆå½“å‰åœºæ™¯
8. âœ… **dequeå†å²ç¼“å†²** - æ€§èƒ½å’Œå¯è¯»æ€§éƒ½å¥½
9. âœ… **é€Ÿåº¦è§‚æµ‹å¤„ç†** - è™½ç„¶å¯ä»¥ä¼˜åŒ–ä½†åŠŸèƒ½æ­£ç¡®
10. âœ… **ROSè¯é¢˜æ¥å£** - å®Œå…¨æ­£ç¡®

---

## ğŸ” éœ€è¦éªŒè¯çš„å‡è®¾

### éªŒè¯1: dashgo_config.pyå‚æ•°ä¸€è‡´æ€§
**éœ€è¦ç¡®è®¤**ï¼š
- `max_lin_acc = 1.0` m/sÂ² æ˜¯å¦ä¸å®è½¦ä¸€è‡´ï¼Ÿ
- `max_ang_acc = 0.6` rad/sÂ² æ˜¯å¦ä¸å®è½¦ä¸€è‡´ï¼Ÿ

**éªŒè¯æ–¹æ³•**ï¼š
```bash
# æŸ¥çœ‹ROSé…ç½®
cat dashgo/EAIé©±åŠ¨/dashgo_bringup/config/*.yaml | grep -E "accel|Acc"
```

### éªŒè¯2: åº•å±‚æ§åˆ¶é¢‘ç‡
**éœ€è¦ç¡®è®¤**ï¼š
- DashGoåº•ç›˜å®é™…æ§åˆ¶é¢‘ç‡æ˜¯10Hzè¿˜æ˜¯20Hzï¼Ÿ

**éªŒè¯æ–¹æ³•**ï¼š
- æŸ¥çœ‹dashgo_bringupé…ç½®
- æŸ¥çœ‹ä»£ç ä¸­çš„å‘å¸ƒé¢‘ç‡è®¾ç½®

### éªŒè¯3: TFåæ ‡ç³»
**éœ€è¦ç¡®è®¤**ï¼ˆæŠ¥å‘Šé—®é¢˜#10ï¼‰ï¼š
- å®è½¦æ˜¯å¦æœ‰`base_link`åæ ‡ç³»ï¼Ÿ
- TFæ ‘ç»“æ„å¦‚ä½•ï¼Ÿ

**éªŒè¯æ–¹æ³•**ï¼š
```bash
# è¿æ¥æœºå™¨äººå
rosrun tf view_frames
# æˆ–
rosrun rqt_tf_tree rqt_tf_tree
```

---

## ğŸ“Š æ–¹æ¡ˆå¯¹æ¯”æ€»ç»“

| å¯¹æ¯”é¡¹ | æ¶æ„å¸ˆå»ºè®® | æœ¬åœ°ä¼˜åŒ–æ–¹æ¡ˆ | è¯´æ˜ |
|-------|----------|-----------|------|
| **æ¨ç†å¼•æ“** | ONNX Runtime | âœ… PyTorch TorchScript | ä¿æŒè®­ç»ƒéƒ¨ç½²ä¸€è‡´æ€§ |
| **å†å²ç¼“å†²** | np.roll() | âœ… deque | æ€§èƒ½æ›´å¥½ |
| **æ§åˆ¶é¢‘ç‡** | âœ… åŠ¨æ€è¯»å– | ç¡¬ç¼–ç  | ğŸ”´ é‡‡çº³å»ºè®® |
| **åŠ é€Ÿåº¦é™åˆ¶** | âœ… åŠ¨æ€è®¡ç®— | ç¡¬ç¼–ç  | ğŸ”´ é‡‡çº³å»ºè®® |
| **ç»´åº¦æ£€æŸ¥** | âœ… åŠ è½½æ—¶æ£€æŸ¥ | æ—  | ğŸ”´ é‡‡çº³å»ºè®® |
| **æ¨¡å‹è·¯å¾„** | âœ… rospkgæŸ¥æ‰¾ | ç›¸å¯¹è·¯å¾„ | ğŸ”´ é‡‡çº³å»ºè®® |
| **è¯é¢˜åç§°** | /cmd_vel_rl + remap | /cmd_vel | ğŸ’¡ å¯é€‰é‡‡çº³ |
| **RVizé…ç½®** | åˆ›å»ºé…ç½®æ–‡ä»¶ | ç¼ºå¤± | ğŸ’¡ å¯é€‰åˆ›å»º |

**ç»“è®º**ï¼š
- ğŸ”´ **4ä¸ªå…³é”®é—®é¢˜å¿…é¡»ä¿®æ”¹**ï¼ˆç»´åº¦æ£€æŸ¥ã€åŠ¨æ€é¢‘ç‡ã€åŠ é€Ÿåº¦ã€è·¯å¾„ï¼‰
- ğŸ’¡ **2ä¸ªå¯é€‰é—®é¢˜å»ºè®®ä¿®æ”¹**ï¼ˆRVizã€è¯é¢˜remapï¼‰
- âœ… **2ä¸ªæŠ€æœ¯é€‰æ‹©ä¿æŒä¸å˜**ï¼ˆPyTorchã€dequeï¼‰

---

**åˆ†æå®Œæˆæ—¶é—´**: 2026-01-28 15:45:30
**åˆ†æè€…**: Claude Code AI Assistant
**çŠ¶æ€**: âœ… åˆ†æå®Œæˆï¼Œç­‰å¾…ç”¨æˆ·ç¡®è®¤åæ‰§è¡Œ

**ä¸‹ä¸€æ­¥**ï¼šç”¨æˆ·ç¡®è®¤åï¼ŒæŒ‰ç…§"ç¬¬ä¸€ä¼˜å…ˆçº§"çš„4ä¸ªå…³é”®é—®é¢˜è¿›è¡Œä¿®æ”¹ã€‚
