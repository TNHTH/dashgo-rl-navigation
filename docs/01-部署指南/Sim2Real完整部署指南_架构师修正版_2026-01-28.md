# Sim2Realå®Œæ•´éƒ¨ç½²æŒ‡å— - æ¶æ„å¸ˆä¿®æ­£ç‰ˆ

> **åˆ›å»ºæ—¶é—´**: 2026-01-28 00:00:00
> **ç‰ˆæœ¬**: v3.1-Architect
> **çŠ¶æ€**: âœ… ä»£ç å·²å®Œæˆï¼Œå¾…æµ‹è¯•
> **åŸºäº**: æ¶æ„å¸ˆå»ºè®® + ç»´åº¦å®Œå…¨å¯¹é½

---

## ğŸ“‹ éƒ¨ç½²å‰å‡†å¤‡

### ç¡¬ä»¶è¦æ±‚

| ç»„ä»¶ | å‹å· | è¯´æ˜ |
|------|------|------|
| **è®¡ç®—å¹³å°** | Jetson Nano 4GB / Ubuntu PC | å¿…é¡»æ”¯æŒPyTorch |
| **æœºå™¨äºº** | DashGo D1 | å·®é€Ÿé©±åŠ¨åº•ç›˜ |
| **LiDAR** | EAI F4 | 360Â°ï¼Œ720ç‚¹ |
| **æ“ä½œç³»ç»Ÿ** | Ubuntu 20.04 + ROS Noetic | å¿…é¡»åŒ¹é… |

### è½¯ä»¶è¦æ±‚

```bash
# ROS Noetic
sudo apt install ros-noetic-desktop

# PyTorch (CPUç‰ˆæœ¬)
pip install torch==1.10.0 torchvision==0.11.0

# æˆ–Jetsonä¸Šä½¿ç”¨l4t-pytorch
# å‚è€ƒ: https://github.com/Qengineering/PyTorch-Jetson
```

### âš ï¸ [é‡è¦] ç¯å¢ƒå‡†å¤‡æ£€æŸ¥è¡¨

åœ¨å¯åŠ¨ROSèŠ‚ç‚¹å‰ï¼Œ**å¿…é¡»**å…ˆæ£€æŸ¥Pythonç¯å¢ƒï¼š

```bash
# 1. æ£€æŸ¥Pythonç‰ˆæœ¬ï¼ˆéœ€è¦3.7+ï¼‰
python3 --version
# é¢„æœŸ: Python 3.7+

# 2. æ£€æŸ¥PyTorchæ˜¯å¦å·²å®‰è£…
python3 -c "import torch; print('PyTorchç‰ˆæœ¬:', torch.__version__)"
# é¢„æœŸ: PyTorchç‰ˆæœ¬: 1.10.0

# 3. å¦‚æœæŠ¥é”™"ModuleNotFoundError: No module named 'torch'"
#    åˆ™éœ€è¦å…ˆå®‰è£…PyTorchï¼ˆè§ä¸‹æ–¹å®‰è£…æŒ‡å—ï¼‰
```

### ğŸ”§ PyTorchå®‰è£…æŒ‡å—

#### é€‰é¡¹Aï¼šåœ¨å½“å‰ç¯å¢ƒå®‰è£…ï¼ˆå¿«é€Ÿæµ‹è¯•ï¼‰

```bash
# CPUç‰ˆæœ¬ï¼ˆé€‚ç”¨äºPC/ç¬”è®°æœ¬ï¼‰
pip install torch==1.10.0 torchvision==0.11.0

# GPUç‰ˆæœ¬ï¼ˆå¦‚æœæœ‰CUDAï¼‰
pip install torch==1.10.0+cu111 torchvision==0.11.0+cu111
```

#### é€‰é¡¹Bï¼šåˆ›å»ºä¸“ç”¨éƒ¨ç½²ç¯å¢ƒï¼ˆæ¨èï¼‰

```bash
# åˆ›å»ºæ–°ç¯å¢ƒ
conda create -n dashgo_deploy python=3.8

# æ¿€æ´»ç¯å¢ƒ
conda activate dashgo_deploy

# å®‰è£…PyTorch
pip install torch==1.10.0 torchvision==0.11.0

# å®‰è£…ROS Pythonä¾èµ–
pip install ros-noetic-tf2-geometry-msgs

# è¿”å›é¡¹ç›®ç›®å½•
cd ~/dashgo_rl_project
```

#### é€‰é¡¹Cï¼šä½¿ç”¨Isaac Labç¯å¢ƒï¼ˆä¸´æ—¶æ–¹æ¡ˆï¼‰

```bash
# æ¿€æ´»Isaac Labç¯å¢ƒï¼ˆåŒ…å«PyTorchï¼‰
conda activate env_isaaclab

# éªŒè¯PyTorch
python3 -c "import torch; print(torch.__version__)"

# ç»§ç»­éƒ¨ç½²æµç¨‹
```

**æ³¨æ„**ï¼š
- env_isaaclabç¯å¢ƒè¾ƒé‡ï¼Œå¯èƒ½å½±å“ROSæ€§èƒ½
- å»ºè®®åˆ›å»ºä¸“ç”¨çš„è½»é‡çº§éƒ¨ç½²ç¯å¢ƒ

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šå¯¼å‡ºæ¨¡å‹ï¼ˆåœ¨è®­ç»ƒæœºå™¨ä¸Šï¼‰

#### 1. è¿è¡Œå¯¼å‡ºè„šæœ¬

```bash
cd ~/dashgo_rl_project

# å¯åŠ¨Isaac Simå¹¶å¯¼å‡ºæ¨¡å‹
~/IsaacLab/isaaclab.sh -p export_torchscript.py
```

#### 2. éªŒè¯å¯¼å‡ºç»“æœ

**é¢„æœŸè¾“å‡º**ï¼š
```
================================================================================
[EXPORT] æ­£åœ¨åˆ†ææ¨¡å‹è¾“å…¥éœ€æ±‚...
================================================================================
  â€¢ ç½‘ç»œç±»å‹: GeoNavPolicy v3.1
  â€¢ æœŸæœ›è¾“å…¥Shape: [1, 246]
  â€¢ æœŸæœ›è¾“å…¥Dtype: torch.float32
  â€¢ è®¾å¤‡: cpu

  è¾“å…¥ç»´åº¦æ‹†è§£:
    - LiDAR: 216 (72 Ã— 3å†å²å¸§)
    - å…¶ä»–çŠ¶æ€: 30
    - å†å²å¸§: 3

âœ… æ¨¡å‹å·²å¯¼å‡ºè‡³: catkin_ws/src/dashgo_rl/models/policy_torchscript.pt
   æ¨¡å‹å¤§å°: 5.23 MB
```

#### 3. æ£€æŸ¥æ–‡ä»¶

```bash
ls -lh catkin_ws/src/dashgo_rl/models/policy_torchscript.pt
# åº”è¯¥æ˜¾ç¤ºçº¦5MB
```

---

### ç¬¬äºŒæ­¥ï¼šç¼–è¯‘ROSå·¥ä½œç©ºé—´

#### 1. ç¼–è¯‘ï¼ˆåœ¨éƒ¨ç½²æœºå™¨ä¸Šï¼‰

```bash
cd ~/dashgo_rl_project/catkin_ws

# ç¼–è¯‘
catkin_make

# å¦‚æœæœ‰ä¾èµ–é—®é¢˜ï¼Œå…ˆå®‰è£…ä¾èµ–
rosdep install --from-paths src --ignore-src -y
```

#### 2. åŠ è½½ç¯å¢ƒ

```bash
source devel/setup.bash

# æ·»åŠ åˆ°.bashrcï¼ˆå¯é€‰ï¼‰
echo "source ~/dashgo_rl_project/catkin_ws/devel/setup.bash" >> ~/.bashrc
```

---

### ç¬¬ä¸‰æ­¥ï¼šGazeboä»¿çœŸæµ‹è¯•

#### æ–¹æ¡ˆAï¼šä½¿ç”¨ç°æœ‰dashgoå·¥ä½œç©ºé—´

```bash
# 1. å¯åŠ¨Gazeboä»¿çœŸ
cd ~/dashgo_rl_project/dashgo/1/1/nav
roslaunch launch/nav01.launch

# 2. æ–°ç»ˆç«¯ï¼šå¯åŠ¨RL Agent
source ~/dashgo_rl_project/catkin_ws/devel/setup.bash
roslaunch dashgo_rl geo_nav.launch

# 3. æ–°ç»ˆç«¯ï¼šå‘é€ç›®æ ‡ç‚¹
rostopic pub /move_base_simple/goal geometry_msgs/PoseStamped "header:
  frame_id: 'map'
pose:
  position:
    x: 2.0
    y: 1.0
  orientation:
    w: 1.0"
```

#### æ–¹æ¡ˆBï¼šä½¿ç”¨RVizå¯è§†åŒ–

```bash
# å¯åŠ¨RViz
rosrun rviz rviz

# æ·»åŠ ä»¥ä¸‹æ˜¾ç¤ºé¡¹ï¼š
# 1. /scan (LaserScan)
# 2. /cmd_vel (Twist)
# 3. /odom (Odometry)
# 4. TF
```

---

### ç¬¬å››æ­¥ï¼šå®ç‰©éƒ¨ç½²

#### 1. ä¼ è¾“æ–‡ä»¶åˆ°Jetson

```bash
# æ‰“åŒ…å·¥ä½œç©ºé—´
cd ~/dashgo_rl_project
tar -czf catkin_ws.tar.gz catkin_ws/

# ä¼ è¾“åˆ°Jetson
scp catkin_ws.tar.gz jetson@dashgo:~/

# åœ¨Jetsonä¸Šè§£å‹
ssh jetson@dashgo
cd ~
tar -xzf catkin_ws.tar.gz
```

#### 2. Jetsonä¸Šç¼–è¯‘

```bash
# å®‰è£…ä¾èµ–
sudo apt update
sudo apt install python3-pip python3-torch ros-noetic-tf2-geometry-msgs -y

# ç¼–è¯‘
cd ~/catkin_ws
catkin_make
source devel/setup.bash
```

#### 3. å¯åŠ¨æœºå™¨äºº

```bash
# Terminal 1: å¯åŠ¨åº•ç›˜
roslaunch dashgo_bringup minimal.launch

# Terminal 2: å¯åŠ¨LiDAR
roslaunch dashgo_bringup lidar.launch

# Terminal 3: å¯åŠ¨RL Agent
source ~/catkin_ws/devel/setup.bash
roslaunch dashgo_rl geo_nav.launch
```

#### 4. å‘é€å¯¼èˆªç›®æ ‡

```bash
# ä½¿ç”¨RVizå‘é€
rosrun rviz rviz

# æˆ–å‘½ä»¤è¡Œå‘é€
rostopic pub /move_base_simple/goal geometry_msgs/PoseStamped "..."
```

---

## ğŸ” éªŒè¯æ¸…å•

### âœ… æ¨¡å‹å¯¼å‡ºéªŒè¯

- [ ] æ–‡ä»¶å­˜åœ¨ï¼š`catkin_ws/src/dashgo_rl/models/policy_torchscript.pt`
- [ ] æ–‡ä»¶å¤§å°ï¼šçº¦5MB
- [ ] è¾“å…¥ç»´åº¦ï¼š[1, 246]
- [ ] æ—¥å¿—æ— é”™è¯¯

### âœ… ROSèŠ‚ç‚¹éªŒè¯

```bash
# æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦åŠ è½½
rosnode list | grep geo_nav_node

# æ£€æŸ¥è¯é¢˜æ˜¯å¦å‘å¸ƒ
rostopic list | grep -E "/scan|/cmd_vel|/odom"

# æ£€æŸ¥è¯é¢˜é¢‘ç‡
rostopic hz /cmd_vel
# é¢„æœŸ: çº¦20Hz
```

### âœ… æ•°æ®æµéªŒè¯

```python
# æ·»åŠ åˆ°èŠ‚ç‚¹ä¸­çš„è°ƒè¯•ä»£ç 
def control_loop(self, event):
    # ...

    # æ‰“å°ç»´åº¦ï¼ˆä»…åœ¨ç¬¬ä¸€ä¸ªepisodeï¼‰
    if not hasattr(self, '_debug_printed'):
        rospy.loginfo(f"è§‚æµ‹ç»´åº¦: {input_tensor.shape}")
        rospy.loginfo(f"LiDAR: {lidar_data.shape}")
        rospy.loginfo(f"Goal: {self.goal_polar.shape}")
        rospy.loginfo(f"Velocity: {self.current_vel[:3].shape}")
        rospy.loginfo(f"Action: {action.shape}")
        self._debug_printed = True
```

---

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1ï¼šç»´åº¦ä¸åŒ¹é…

**ç—‡çŠ¶**ï¼š
```
RuntimeError: mat1 and mat2 shapes cannot be multiplied: [1, 77] vs [1, 246]
```

**åŸå› **ï¼š
- ä½¿ç”¨äº†åŠ©æ‰‹ç‰ˆæœ¬çš„èŠ‚ç‚¹ï¼ˆ77ç»´ï¼‰
- æ¨¡å‹éœ€è¦246ç»´

**è§£å†³**ï¼š
```bash
# ç¡®è®¤ä½¿ç”¨çš„æ˜¯æ¶æ„å¸ˆä¿®æ­£ç‰ˆèŠ‚ç‚¹
head -20 catkin_ws/src/dashgo_rl/scripts/geo_nav_node.py | grep "æ¶æ„å¸ˆ"
# åº”è¯¥çœ‹åˆ°: "# ä½œè€…: Isaac Sim Architect"
```

### é—®é¢˜2ï¼šæ¨¡å‹åŠ è½½å¤±è´¥

**ç—‡çŠ¶**ï¼š
```
FileNotFoundError: [Errno 2] No such file or directory: 'policy_torchscript.pt'
```

**è§£å†³**ï¼š
```bash
# æ£€æŸ¥æ¨¡å‹è·¯å¾„
ls -l catkin_ws/src/dashgo_rl/models/

# å¦‚æœæ²¡æœ‰ï¼Œè¿è¡Œå¯¼å‡ºè„šæœ¬
~/IsaacLab/isaaclab.sh -p export_torchscript.py
```

### ğŸš¨ é—®é¢˜3ï¼šROSèŠ‚ç‚¹å¯åŠ¨å¤±è´¥ - ç¼ºå°‘PyTorchä¾èµ–

**ç—‡çŠ¶**ï¼š
```bash
Traceback (most recent call last):
  File "geo_nav_node.py", line 15, in <module>
    import torch
ModuleNotFoundError: No module named 'torch'
```

**åœºæ™¯**ï¼š
- å¯åŠ¨GazeboæˆåŠŸ âœ…
- å¯åŠ¨geo_nav_nodeèŠ‚ç‚¹å¤±è´¥ âŒ
- é”™è¯¯ï¼šç¼ºå°‘torchæ¨¡å—

**åŸå› **ï¼š
- å½“å‰Pythonç¯å¢ƒæ²¡æœ‰å®‰è£…PyTorch
- è®­ç»ƒç¯å¢ƒï¼ˆenv_isaaclabï¼‰ä¸éƒ¨ç½²ç¯å¢ƒï¼ˆbaseï¼‰åˆ†ç¦»
- ç¯å¢ƒéš”ç¦»å¯¼è‡´ä¾èµ–ç¼ºå¤±

**è§£å†³æ–¹æ¡ˆ**ï¼š

##### æ–¹æ¡ˆAï¼šå¿«é€Ÿä¿®å¤ï¼ˆé€‚åˆPCæµ‹è¯•ï¼‰

```bash
# 1. æ£€æŸ¥å½“å‰ç¯å¢ƒ
conda info --envs

# 2. åœ¨å½“å‰ç¯å¢ƒå®‰è£…PyTorch
pip install torch==1.10.0 torchvision==0.11.0

# 3. éªŒè¯å®‰è£…
python3 -c "import torch; print('PyTorchç‰ˆæœ¬:', torch.__version__)"

# 4. é‡æ–°å¯åŠ¨èŠ‚ç‚¹
source ~/dashgo_rl_project/catkin_ws/devel/setup.bash
roslaunch dashgo_rl geo_nav.launch
```

##### æ–¹æ¡ˆBï¼šåˆ›å»ºä¸“ç”¨éƒ¨ç½²ç¯å¢ƒï¼ˆæ¨èï¼‰

```bash
# 1. åˆ›å»ºæ–°ç¯å¢ƒ
conda create -n dashgo_deploy python=3.8 -y

# 2. æ¿€æ´»ç¯å¢ƒ
conda activate dashgo_deploy

# 3. å®‰è£…PyTorch
pip install torch==1.10.0 torchvision==0.11.0

# 4. å®‰è£…ROSä¾èµ–
pip install ros-noetic-tf2-geometry-msgs

# 5. è¿”å›é¡¹ç›®å¹¶ç¼–è¯‘
cd ~/dashgo_rl_project/catkin_ws
catkin_make
source devel/setup.bash

# 6. å¯åŠ¨èŠ‚ç‚¹
roslaunch dashgo_rl geo_nav.launch
```

##### æ–¹æ¡ˆCï¼šä½¿ç”¨Isaac Labç¯å¢ƒï¼ˆä¸´æ—¶æ–¹æ¡ˆï¼‰

```bash
# æ¿€æ´»Isaac Labç¯å¢ƒï¼ˆåŒ…å«PyTorchï¼‰
conda activate env_isaaclab

# éªŒè¯PyTorch
python3 -c "import torch; print('âœ… PyTorchå·²å®‰è£…:', torch.__version__)"

# ç¼–è¯‘å·¥ä½œç©ºé—´ï¼ˆé¦–æ¬¡éœ€è¦ï¼‰
cd ~/dashgo_rl_project/catkin_ws
catkin_make
source devel/setup.bash

# å¯åŠ¨èŠ‚ç‚¹
roslaunch dashgo_rl geo_nav.launch
```

**æ³¨æ„**ï¼š
- env_isaaclabç¯å¢ƒè¾ƒé‡ï¼Œå¯èƒ½å½±å“ROSæ€§èƒ½
- å»ºè®®é•¿æœŸä½¿ç”¨æ–¹æ¡ˆBï¼ˆä¸“ç”¨éƒ¨ç½²ç¯å¢ƒï¼‰

**ç¯å¢ƒç®¡ç†æœ€ä½³å®è·µ**ï¼š
```bash
# è®­ç»ƒç¯å¢ƒï¼ˆenv_isaaclabï¼‰
conda activate env_isaaclab
~/IsaacLab/isaaclab.sh -p train_v2.py ...

# éƒ¨ç½²ç¯å¢ƒï¼ˆdashgo_deployï¼‰
conda activate dashgo_deploy
roslaunch dashgo_rl geo_nav.launch ...
```

---

### é—®é¢˜3ï¼šTFæŸ¥è¯¢å¤±è´¥

**ç—‡çŠ¶**ï¼š
```
âš ï¸ TFæŸ¥è¯¢å¤±è´¥
```

**åŸå› **ï¼š
- frame_idä¸åŒ¹é…
- TFæ ‘æœªå»ºç«‹

**è§£å†³**ï¼š
```bash
# æ£€æŸ¥TFæ ‘
rosrun tf tf_echo map base_link

# æ£€æŸ¥frame_id
rostopic echo /scan | grep frame_id
```

### é—®é¢˜4ï¼šæœºå™¨äººä¸åŠ¨

**ç—‡çŠ¶**ï¼š
èŠ‚ç‚¹å¯åŠ¨ä½†æœºå™¨äººæ— ååº”

**æ’æŸ¥æ­¥éª¤**ï¼š
```bash
# 1. æ£€æŸ¥ç›®æ ‡æ˜¯å¦æ”¶åˆ°
rostopic echo /move_base_simple/goal -n 1

# 2. æ£€æŸ¥/odomæ˜¯å¦å‘å¸ƒ
rostopic hz /odom

# 3. æ£€æŸ¥/cmd_velæ˜¯å¦å‘å¸ƒ
rostopic hz /cmd_vel

# 4. å¯ç”¨è°ƒè¯•æ—¥å¿—
rosservice call /geo_nav_node/set_logger_level ros.DEBUG
```

---

## ğŸ“Š æ€§èƒ½åŸºå‡†

### é¢„æœŸæ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ä»¿çœŸ (Gazebo) | å®ç‰© (Jetson) |
|------|--------------|----------------|
| **æ§åˆ¶é¢‘ç‡** | 20 Hz | 15-20 Hz |
| **æ¨ç†å»¶è¿Ÿ** | <5 ms | <10 ms |
| **å†…å­˜å ç”¨** | ~200 MB | ~150 MB |
| **CPUå ç”¨** | 20-30% | 40-60% |

### ä¼˜åŒ–å»ºè®®

**Jetsonä¼˜åŒ–**ï¼š
```bash
# 1. ä½¿ç”¨Max-Næ¨¡å¼ï¼ˆæœ€å¤§æ€§èƒ½ï¼‰
sudo nvpmodel -m 0

# 2. å¯ç”¨GPUï¼ˆå¦‚æœå®‰è£…äº†CUDA PyTorchï¼‰
# åœ¨èŠ‚ç‚¹ä¸­ä¿®æ”¹ï¼š
self.device = torch.device("cuda")

# 3. ä½¿ç”¨OpenVINOï¼ˆè¿›é˜¶ï¼‰
# å¯¼å‡ºONNXæ¨¡å‹
# ä½¿ç”¨OpenVINOå·¥å…·é“¾ä¼˜åŒ–
```

---

## ğŸ“ ç»´æŠ¤å»ºè®®

### æ—¥å¿—è®°å½•

```bash
# è®°å½•æ‰€æœ‰è¯é¢˜åˆ°bagæ–‡ä»¶
mkdir -p ~/bags/rl_test
rosbag record -O ~/bags/rl_test/test.bag \
  /scan \
  /odom \
  /cmd_vel \
  /move_base_simple/goal
```

### å‚æ•°è°ƒæ•´

**å¸¸è§è°ƒæ•´**ï¼š
```xml
<!-- åœ¨launchæ–‡ä»¶ä¸­è°ƒæ•´ -->
<arg name="max_lin_vel" default="0.5" />  <!-- æé«˜æœ€å¤§é€Ÿåº¦ -->
<arg name="max_ang_vel" default="1.5" />  <!-- æé«˜æœ€å¤§è§’é€Ÿåº¦ -->
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥

### çŸ­æœŸç›®æ ‡ï¼ˆæœ¬å‘¨ï¼‰

1. âœ… å®Œæˆæ¨¡å‹å¯¼å‡º
2. âœ… Gazeboä»¿çœŸæµ‹è¯•
3. â¬œ å®ç‰©éƒ¨ç½²æµ‹è¯•
4. â¬œ æ€§èƒ½ä¼˜åŒ–

### é•¿æœŸç›®æ ‡ï¼ˆæœ¬æœˆï¼‰

1. â¬œ OpenVINOä¼˜åŒ–
2. â¬œ å®‰å…¨è¿‡æ»¤å™¨é›†æˆ
3. â¬œ è¿œç¨‹ç›‘æ§ç•Œé¢
4. â¬œ è‡ªåŠ¨åŒ–æµ‹è¯•

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **æ¶æ„å¸ˆå»ºè®®**: `docs/æ¶æ„å¸ˆå»ºè®®.md`
- **è¯„ä¼°æŠ¥å‘Š**: `docs/æ¶æ„å¸ˆå»ºè®®è¯„ä¼°ä¸åˆ†ææŠ¥å‘Š_2026-01-27.md`
- **Geo-Distill V2.2**: `docs/Geo-Distill-V2.2-å®Œæ•´æ–¹æ¡ˆè¯´æ˜_2026-01-27.md`
- **Sim2Realæ–¹æ¡ˆ**: `docs/DashGo-Sim2Realå®Œæ•´éƒ¨ç½²æ–¹æ¡ˆ_v3.0_2026-01-27.md`

---

**ç»´æŠ¤è€…**: Claude Code AI Assistant (åŸºäºæ¶æ„å¸ˆæ–¹æ¡ˆ)
**é¡¹ç›®**: DashGo RL Navigation
**ç‰ˆæœ¬**: v3.1-Architect-Fixed
**æ—¥æœŸ**: 2026-01-28
**çŠ¶æ€**: âœ… ä»£ç å®Œæˆï¼Œå¾…æµ‹è¯•éªŒè¯
