# 轮子悬空无法移动问题 - 底盘拖底（Bottoming Out）

> **创建时间**: 2026-01-29 02:50:00
> **严重程度**: 🔴 严重（物理仿真失效）
> **状态**: ✅ 已修复
> **相关文件**: dashgo_d1_sim.urdf.xacro, sim2real_golden.launch
> **诊断者**: Claude Code + Isaac Sim架构师

---

## 问题描述

### 现象：轮子悬空，小车无法移动

**症状**:
- ❌ Gazebo中轮子嵌在底盘里（视觉上）
- ❌ 小车无法移动，轮子空转
- ❌ 底盘碰撞体先着地，轮子悬空

**背景**:
- 用户按照之前的修复缩小了碰撞半径（0.20 → 0.15 → 0.10）
- 调整了spawn高度到0.0632m
- 但轮子还是悬空，无法接触地面

---

## 🧠 诊断过程

### 第一次诊断：缩小碰撞半径（无效）

**假设**: 底盘碰撞半径太大，水平方向与轮子冲突

**修复尝试**:
```xml
<!-- 第1次 -->
<cylinder radius="0.15"/>  <!-- 从0.20缩小 -->

<!-- 第2次 -->
<cylinder radius="0.10"/>  <!-- 从0.15进一步缩小 -->
```

**结果**: ❌ 无效，轮子还是悬空

### 第二次诊断：调整spawn高度（无效）

**假设**: spawn高度太低，导致姿态异常

**修复尝试**:
```xml
<!-- launch文件 -->
spawn_model -z 0.0632  <!-- 调整为轮子半径 -->
```

**结果**: ❌ 无效，轮子还是悬空

### 第三次诊断：用户发现根本原因 ✅

**关键发现**:
> "我发现是底盘已经碰到地上了，但是轮子还没碰到地上，底盘把小车顶起来了"

**真相大白**:
- 不是水平方向碰撞（半径问题）
- 而是**垂直方向拖底**（高度问题）

---

## 🎯 Isaac Sim架构师诊断

### 根本原因：底盘拖底（Bottoming Out）

**架构师的解释**:
> "这是典型的'底盘拖底'现象。机器人的'肚子'太大了（或者挂得太低了），导致肚子先着地，把轮子悬空架起来了。就像一辆跑车去越野，底盘卡在大石头上，轮子在空转。"

**数学分析**:

**旧配置**:
```xml
<collision>
  <origin xyz="0 0 0" rpy="0 0 0"/>  <!-- 中心在base_link原点 -->
  <geometry>
    <cylinder length="0.21" radius="0.10"/>  <!-- 高度0.21m，半径0.10m -->
  </geometry>
</collision>
```

**几何计算**:
```
底盘中心：z = 0 (相对于base_link)
底盘厚度：0.21m
底盘底部：z = 0 - 0.21/2 = -0.105m ❌ 埋得很低！

轮子半径：0.0632m
轮子中心：z = 0
轮子底部：z = -0.0632m

对比：
底盘底部 (-0.105) < 轮子底部 (-0.0632)
结论：底盘先着地，轮子架空 ❌ 问题根源！
```

---

## 💡 解决方案

### 方案A：抬高碰撞体 + 减小厚度（采用）

**架构师建议**（稍微调整radius）:

```xml
<collision>
  <origin xyz="0 0 0.05" rpy="0 0 0"/>  <!-- 向上抬高5cm -->
  <geometry>
    <cylinder length="0.10" radius="0.10"/>  <!-- 厚度减半，半径保持0.10 -->
  </geometry>
</collision>
```

**关键修改**:
1. **origin z**: 0 → 0.05（向上抬高5cm）
2. **length**: 0.21 → 0.10（厚度减半）
3. **radius**: 保持0.10（避免水平方向碰撞）

**新几何验证**:

垂直方向：
```
底盘中心：z = 0.05m
底盘厚度：0.10m
底盘底部：z = 0.05 - 0.10/2 = 0.00m ✅

轮子底部：z = -0.0632m
底盘底部 (0.00) > 轮子底部 (-0.0632)
结论：轮子先着地，底盘悬空6.3cm ✅ 物理正确！
```

水平方向：
```
轮子内沿：0.171 - 0.0632 = 0.1078m
底盘半径：0.10m
底盘半径 (0.10) < 轮子内沿 (0.1078)
结论：不会水平碰撞 ✅ 安全！
```

### 方案B：更激进的修改（未采用）

**架构师原建议**:
```xml
<collision>
  <origin xyz="0 0 0.05" rpy="0 0 0"/>
  <geometry>
    <cylinder length="0.10" radius="0.15"/>  <!-- 半径增大到0.15 -->
  </geometry>
</collision>
```

**为什么未采用**:
```
底盘半径 (0.15) > 轮子内沿 (0.1078)
结论：可能导致水平方向碰撞 ❌ 风险！
```

---

## 🔧 实施步骤

### 修改1：调整底盘碰撞体（URDF）

**文件**: `catkin_ws/src/dashgo_rl/urdf/dashgo_d1_sim.urdf.xacro`
**位置**: 第57-62行

```bash
nano ~/dashgo_rl_project/catkin_ws/src/dashgo_rl/urdf/dashgo_d1_sim.urdf.xacro
```

**修改**:
```xml
<collision>
  <origin xyz="0 0 0.05" rpy="0 0 0"/>
  <geometry>
    <cylinder length="0.10" radius="0.10"/>
  </geometry>
</collision>
```

**Commit**: `82e1f6e` - fix: 抬高底盘碰撞体避免拖底(方案A)

### 修改2：调整spawn高度（Launch文件）

**文件**: `catkin_ws/src/dashgo_rl/launch/sim2real_golden.launch`
**位置**: 第82行

```xml
<node name="spawn_dashgo" pkg="gazebo_ros" type="spawn_model"
      args="-urdf -param robot_description -model dashgo -x 0 -y 0 -z 0.0632"
      output="screen"/>
```

**Commit**: `ffed4ef` - fix: 调整spawn高度让轮子接触地面

---

## ✅ 验证方法

### 1. 视觉检查（Gazebo）

**启用碰撞透视**:
- Gazebo菜单: **View** → **Collisions**（勾选）
- 观察橙色碰撞体是否悬空

**预期结果**:
- ✅ 轮子的橙色碰撞体压在地面（z=0）
- ✅ 底盘的橙色碰撞体悬空（底部在z=0.00）
- ✅ 中间有6.3mm空隙

### 2. 物理测试（移动）

**方法1: 2D Nav Goal**:
- 在RViz中使用"2D Nav Goal"发送目标点
- 观察小车是否能移动

**方法2: 速度命令**:
```bash
rostopic pub /cmd_vel geometry_msgs/Twist \
  "linear: {x: 0.2, y: 0, z: 0}, angular: {x: 0, y: 0, z: 0}" --once
```

**预期结果**:
- ✅ 轮子转动
- ✅ 车身跟随移动
- ✅ 不再空转或抽搐

---

## 🎓 经验教训

### 1. Visual vs Collision的分离原则

**教训**:
- 视觉模型（Visual）可以和物理模型（Collision）不同
- Visual用于显示，Collision用于物理
- 即使Visual嵌在一起，Collision可以是分离的

**应用**:
- 底盘Visual半径=0.20（好看）
- 底盘Collision半径=0.10（不碰撞）
- 底盘Collision底部=0.00（抬高5cm）

### 2. 垂直方向拖底容易被忽略

**教训**:
- 大部分时候关注水平方向碰撞（半径）
- 忽略了垂直方向拖底（高度+厚度）
- 需要同时检查xyz三个维度

**检查清单**:
```python
# 垂直方向
chassis_bottom_z = origin_z - length/2
wheel_bottom_z = wheel_center_z - wheel_radius
if chassis_bottom_z < wheel_bottom_z:
    print("警告：底盘会拖底！")
```

### 3. origin的重要性

**教训**:
- origin定义了几何体的中心位置
- 修改origin可以移动整个碰撞体
- 比单纯改尺寸更灵活

**最佳实践**:
- 优先用origin调整位置
- 用length/radius调整大小
- 数学验证每个维度的边界

### 4. 渐进式调试

**调试过程**:
1. 第一次：缩小半径（假设水平碰撞）→ 无效
2. 第二次：调整spawn高度（假设姿态问题）→ 无效
3. 第三次：用户发现真相（底盘拖底）→ 找到根因

**经验**:
- ❌ 不要盲目修改参数
- ✅ 先诊断再动手
- ✅ 用户观察很重要（"底盘碰到地面"）

---

## 📚 相关文档

- **架构师对话**: docs/architect-dialogues/（待整理）
- **相关问题**:
  - `2026-01-29_0120_轮子穿模卡死_碰撞体积冲突.md`（之前的轮子卡死问题）
  - `2026-01-29_0115_RViz完全盲区_渲染失效与配置缓存.md`

---

## 🔗 相关Commit

- `5e0f195` - fix: 进一步缩小底盘碰撞半径防止轮子嵌套
- `ffed4ef` - fix: 调整spawn高度让轮子接触地面
- `82e1f6e` - fix: 抬高底盘碰撞体避免拖底(方案A) ✅ 最终修复

---

## 📝 验证清单

**修改前**:
- [x] 确认轮子悬空（用户观察）
- [x] 确认底盘先着地（用户观察）
- [x] 计算几何边界（数学验证）

**修改后**:
- [ ] 重启roslaunch加载新URDF
- [ ] Gazebo中验证轮子接触地面
- [ ] RViz中测试2D Nav Goal
- [ ] 确认小车能正常移动

---

**维护者**: Claude Code AI Assistant
**状态**: 等待用户验证修复效果
