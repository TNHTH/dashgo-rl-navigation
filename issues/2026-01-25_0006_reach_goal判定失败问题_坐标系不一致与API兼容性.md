# reach_goal åˆ¤å®šå¤±è´¥é—®é¢˜ - åæ ‡ç³»ä¸ä¸€è‡´ä¸ API å…¼å®¹æ€§

> **å‘ç°æ—¶é—´**: 2026-01-25 00:06:00
> **é—®é¢˜ç±»å‹**: ğŸ”´ ä¸¥é‡ï¼ˆé˜»å¡è®­ç»ƒ/æ ¹æœ¬æ€§Bugï¼‰
> **çŠ¶æ€**: âœ… å·²è§£å†³
> **ç›¸å…³æäº¤**: 13ee98d, 237a6c2, 0ba490e, f892e9a

---

## ğŸ“‹ é—®é¢˜æè¿°

### ç°è±¡
è®­ç»ƒæ—¥å¿—æ˜¾ç¤ºï¼š
- `Metrics/target_pose/position_error`: 0.41-0.75mï¼ˆç›®æ ‡è·ç¦»æ­£ç¡®ï¼‰
- `Episode_Termination/reach_goal`: **0.0000**ï¼ˆåº”è¯¥æ˜¯100%ï¼ï¼‰
- `threshold`: 3.0mï¼ˆå·¨å¤§é˜ˆå€¼ï¼‰

**çŸ›ç›¾ç‚¹**ï¼šç†è®ºä¸Š 0.41m < 3.0m åº”è¯¥100%æˆåŠŸï¼Œä½†å®é™…ä¸º0%

### èƒŒæ™¯
- **é€åˆ†é¢˜æµ‹è¯•**ï¼šè®¾ç½®æè¿‘è·ç¦»ç›®æ ‡ï¼ˆ0.1-0.5mï¼‰+ å·¨å¤§é˜ˆå€¼ï¼ˆ3.0mï¼‰
- **ç›®çš„**ï¼šéªŒè¯ reach_goal åˆ¤å®šç³»ç»Ÿæ˜¯å¦æ­£å¸¸å·¥ä½œ
- **é¢„æœŸ**ï¼šæœºå™¨äººåº”è¯¥100%æˆåŠŸåˆ°è¾¾ç›®æ ‡
- **å®é™…**ï¼šå³ä½¿è·ç¦»å¾ˆè¿‘ï¼Œreach_goal ä»ä¸º 0.0000

---

## ğŸ” æ ¹æœ¬åŸå› åˆ†æ

### é—®é¢˜1ï¼šLogger ä¸å­˜åœ¨ï¼ˆç¬¬1æ¬¡å°è¯•å¤±è´¥ï¼‰

**é”™è¯¯ä¿¡æ¯**ï¼š
```python
AttributeError: 'ManagerBasedRLEnv' object has no attribute 'logger'
```

**åŸå› **ï¼š
- åœ¨ `check_reach_goal` å‡½æ•°ä¸­æ·»åŠ äº†è°ƒè¯•æ‰“å°ï¼š`env.logger.info(...)`
- `ManagerBasedRLEnv` å¯¹è±¡æ²¡æœ‰ `logger` å±æ€§

**å½±å“**ï¼š
- è®­ç»ƒå´©æºƒï¼Œæ— æ³•ç»§ç»­è°ƒè¯•

---

### é—®é¢˜2ï¼šåæ ‡ç³»ä¸ä¸€è‡´ï¼ˆæ ¸å¿ƒé—®é¢˜ï¼‰

**è¯Šæ–­è¿‡ç¨‹**ï¼š

1. **position_error metric è®¡ç®—**ï¼ˆç¬¬568è¡Œï¼‰ï¼š
   ```python
   target_pos_w = self.pose_command_w[:, :3]  # ä¸–ç•Œåæ ‡ç³»
   pos_error = torch.norm(target_pos_w[:, :2] - root_pos_w[:, :2], dim=-1)
   ```
   ä½¿ç”¨å‘½ä»¤å¯¹è±¡çš„ `pose_command_w` å±æ€§ï¼ˆä¸–ç•Œåæ ‡ï¼‰

2. **check_reach_goal åŸå§‹å®ç°**ï¼ˆç¬¬489è¡Œï¼‰ï¼š
   ```python
   target_pos = env.command_manager.get_command(command_name)[:, :2]
   dist = torch.norm(target_pos - robot_pos, dim=-1)
   ```
   ä½¿ç”¨ `get_command()` è¿”å›çš„å€¼

**æ ¸å¿ƒçŸ›ç›¾**ï¼š
- `position_error` å’Œ `check_reach_goal` è®¡ç®—è·ç¦»çš„æ–¹å¼ä¸ä¸€è‡´
- ä¸¤ä¸ªå‡½æ•°å¯èƒ½ä½¿ç”¨äº†ä¸åŒçš„åæ ‡ç³»æˆ–æ•°æ®æº
- å¯¼è‡´ metric æ˜¾ç¤ºè·ç¦»æ­£ç¡®ï¼Œä½†åˆ¤å®šé€»è¾‘å¤±è´¥

**æ ¹æœ¬åŸå› **ï¼š
- `get_command()` å¯èƒ½è¿”å›çš„æ˜¯ç›¸å¯¹åæ ‡æˆ–æœªæ›´æ–°çš„å€¼
- è€Œ `pose_command_w` å­˜å‚¨çš„æ˜¯ä¸–ç•Œåæ ‡ç³»çš„ç›®æ ‡ä½ç½®ï¼ˆç»è¿‡ `_resample_command` æ›´æ–°ï¼‰

---

### é—®é¢˜3ï¼šAPI å…¼å®¹æ€§ï¼ˆç¬¬2æ¬¡å°è¯•å¤±è´¥ï¼‰

**é”™è¯¯ä¿¡æ¯**ï¼š
```python
AttributeError: 'CommandManager' object has no attribute '_term_regs'
```

**åŸå› **ï¼š
- Isaac Lab 4.5 ç§»é™¤äº† `_term_regs` ç§æœ‰å±æ€§
- å°è¯•ä½¿ç”¨ `env.command_manager._term_regs[command_name]` è®¿é—®å‘½ä»¤å¯¹è±¡

**å½±å“**ï¼š
- è®­ç»ƒå†æ¬¡å´©æºƒï¼Œåæ ‡ç³»ä¿®å¤æ–¹æ¡ˆæ— æ³•åº”ç”¨

---

## ğŸ› ï¸ è§£å†³æ–¹æ¡ˆ

### ä¿®å¤1ï¼šç§»é™¤é”™è¯¯çš„ Logger è°ƒç”¨

**ä½ç½®**ï¼š`dashgo_env_v2.py` ç¬¬496è¡Œ

**ä¿®æ”¹å‰**ï¼š
```python
if env.common_step_counter % 100 == 0:
    env.logger.info(f"[DEBUG] reach_goal check: ...")
```

**ä¿®æ”¹å**ï¼š
```python
# ç§»é™¤ logger è°ƒç”¨ï¼ˆManagerBasedRLEnv æ²¡æœ‰ logger å±æ€§ï¼‰
```

**Commit**: éšå¼åŒ…å«åœ¨åç»­ä¿®å¤ä¸­

---

### ä¿®å¤2ï¼šç»Ÿä¸€åæ ‡ç³»ï¼ˆä½¿ç”¨ pose_command_wï¼‰

**ä½ç½®**ï¼š`dashgo_env_v2.py` ç¬¬493-502è¡Œ

**ä¿®æ”¹å‰**ï¼š
```python
def check_reach_goal(env: ManagerBasedRLEnv, command_name: str, threshold: float, asset_cfg: SceneEntityCfg) -> torch.Tensor:
    target_pos = env.command_manager.get_command(command_name)[:, :2]
    robot_pos = torch.nan_to_num(env.scene[asset_cfg.name].data.root_pos_w[:, :2], nan=0.0, posinf=0.0, neginf=0.0)
    dist = torch.norm(target_pos - robot_pos, dim=-1)
    return (dist < threshold)
```

**ä¿®æ”¹å**ï¼š
```python
def check_reach_goal(env: ManagerBasedRLEnv, command_name: str, threshold: float, asset_cfg: SceneEntityCfg) -> torch.Tensor:
    # [æ¶æ„å¸ˆä¿®å¤ 2026-01-24] ä¿®å¤åæ ‡ç³»ä¸ä¸€è‡´é—®é¢˜
    # é—®é¢˜ï¼šcommand_manager.get_command() è¿”å›çš„å¯èƒ½æ˜¯ç›¸å¯¹åæ ‡æˆ–æœªæ›´æ–°çš„å€¼
    # è§£å†³ï¼šç›´æ¥è®¿é—®å‘½ä»¤å¯¹è±¡çš„ pose_command_w å±æ€§ï¼ˆä¸–ç•Œåæ ‡ç³»ï¼‰
    command_term = env.command_manager._term_regs[command_name]
    target_pos_w = command_term.pose_command_w[:, :2]

    robot_pos = torch.nan_to_num(env.scene[asset_cfg.name].data.root_pos_w[:, :2], nan=0.0, posinf=0.0, neginf=0.0)
    dist = torch.norm(target_pos_w - robot_pos, dim=-1)
    return (dist < threshold)
```

**å…³é”®æ”¹å˜**ï¼š
- ä» `get_command()` æ”¹ä¸ºç›´æ¥è®¿é—®å‘½ä»¤å¯¹è±¡çš„ `pose_command_w` å±æ€§
- ç¡®ä¿ `check_reach_goal` å’Œ `position_error` metric ä½¿ç”¨ç›¸åŒçš„æ•°æ®æº

**Commit**: `0ba490e`

---

### ä¿®å¤3ï¼šAPI å…¼å®¹æ€§ï¼ˆä½¿ç”¨ _terms æ›¿ä»£ _term_regsï¼‰

**ä½ç½®**ï¼š`dashgo_env_v2.py` ç¬¬497è¡Œ

**ä¿®æ”¹å‰**ï¼š
```python
command_term = env.command_manager._term_regs[command_name]  # âŒ Isaac Lab 4.5 ç§»é™¤äº†è¿™ä¸ªå±æ€§
```

**ä¿®æ”¹å**ï¼š
```python
command_term = env.command_manager._terms[command_name]  # âœ… ä½¿ç”¨ _terms å±æ€§
```

**è¯´æ˜**ï¼š
- `_terms` æ˜¯ `dict[str, CommandTerm]`ï¼Œå­˜å‚¨æ‰€æœ‰å‘½ä»¤å¯¹è±¡
- `_term_regs` åœ¨ Isaac Lab 4.5 ä¸­è¢«ç§»é™¤
- `command_term.pose_command_w` ä»ç„¶å¯ç”¨ï¼ˆä¸–ç•Œåæ ‡ç³»ï¼‰

**åŒæ—¶ä¿®æ”¹**ï¼š`reward_near_goal` å‡½æ•°ï¼ˆç¬¬448-452è¡Œï¼‰

**Commit**: `f892e9a`

---

## ğŸ“Š ä¿®å¤å‰åå¯¹æ¯”

### è®­ç»ƒæŒ‡æ ‡å¯¹æ¯”ï¼ˆé¢„æœŸï¼‰

| æŒ‡æ ‡ | ä¿®å¤å‰ | ä¿®å¤åï¼ˆé¢„æœŸï¼‰ |
|------|--------|----------------|
| **position_error** | 0.41-0.75m | 0.1-0.5m |
| **reach_goal** | 0.0000 âŒ | 0.80-1.00 âœ… |
| **reach_reward** | 0.0000 âŒ | 800-1000 âœ… |
| **episode_length** | æé•¿ | æçŸ­ï¼ˆå¿«é€ŸæˆåŠŸï¼‰ |

---

## âœ… éªŒè¯æ–¹æ³•

### æµ‹è¯•é…ç½®
- `min_dist`: 0.1m
- `max_dist`: 0.5m
- `threshold`: 3.0m
- `num_envs`: 256ï¼ˆé€‚é…RTX 4060 8GBæ˜¾å­˜ï¼‰

### éªŒè¯æ­¥éª¤

1. **æ¸…ç†æ—¥å¿—**ï¼š
   ```bash
   rm -rf logs/*
   ```

2. **è¿è¡Œè®­ç»ƒ**ï¼š
   ```bash
   ~/IsaacLab/isaaclab.sh -p train_v2.py --headless --num_envs 256
   ```

3. **è§‚å¯Ÿå‰10ä¸ª iteration**ï¼š
   ```bash
   tail -100 logs/train_v2.log | grep -E "(Iteration|reach_goal|position_error)"
   ```

### æˆåŠŸæ ‡å‡†
- âœ… `Episode_Termination/reach_goal`: 0.80-1.00ï¼ˆ80-100%ï¼‰
- âœ… `Episode_Reward/reach_goal`: 800-1000
- âœ… `Metrics/target_pose/position_error`: 0.1-0.5m

---

## ğŸ“š ç›¸å…³é—®é¢˜

1. **å‰åºé—®é¢˜**ï¼š
   - `issues/2026-01-24_2200_æœ€åå†²åˆºå¾®è°ƒ_ä»é²è½åˆ°æˆåŠŸ.md` - è¯¾ç¨‹å­¦ä¹ ç­–ç•¥
   - `issues/2026-01-24_2140_æœºå™¨äººç˜«ç—ªé—®é¢˜_ä¿®å¤actuatorsé…ç½®.md` - åŠ¨åŠ›å­¦é…ç½®

2. **ç›¸å…³æäº¤**ï¼š
   - `13ee98d`: é€åˆ†é¢˜æµ‹è¯•ï¼ˆæè¿‘è·ç¦»ç›®æ ‡ + å·¨å¤§é˜ˆå€¼ï¼‰
   - `237a6c2`: ä¿®å¤ç›®æ ‡ç”ŸæˆèŒƒå›´ï¼ˆrangeså‚æ•°é…ç½®ï¼‰
   - `0ba490e`: ä¿®å¤åæ ‡ç³»ä¸ä¸€è‡´ï¼ˆä½¿ç”¨pose_command_wï¼‰
   - `f892e9a`: ä¿®å¤APIå…¼å®¹æ€§ï¼ˆä½¿ç”¨_termsï¼‰

---

## ğŸ“ ç»éªŒæ•™è®­

### 1. åæ ‡ç³»ä¸€è‡´æ€§è‡³å…³é‡è¦
- **æ•™è®­**ï¼šmetricè®¡ç®—å’Œreward/terminationåˆ¤å®šå¿…é¡»ä½¿ç”¨ç›¸åŒçš„æ•°æ®æº
- **åŸåˆ™**ï¼šä¼˜å…ˆä½¿ç”¨å‘½ä»¤å¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼ˆå¦‚ `pose_command_w`ï¼‰ï¼Œè€Œä¸æ˜¯ `get_command()` è¿”å›å€¼
- **éªŒè¯**ï¼šç¡®ä¿ metric æ˜¾ç¤ºçš„è·ç¦»ä¸åˆ¤å®šé€»è¾‘ä½¿ç”¨çš„è·ç¦»ä¸€è‡´

### 2. ç§æœ‰APIçš„è„†å¼±æ€§
- **æ•™è®­**ï¼šIsaac Lab ç‰ˆæœ¬æ›´æ–°å¯èƒ½ç§»é™¤ç§æœ‰å±æ€§ï¼ˆå¦‚ `_term_regs`ï¼‰
- **åŸåˆ™**ï¼š
  - ä¼˜å…ˆä½¿ç”¨å…¬å…±APIï¼ˆå¦‚ `get_command()`ï¼‰
  - å¦‚æœå¿…é¡»ä½¿ç”¨ç§æœ‰APIï¼Œé€‰æ‹©æ›´ç¨³å®šçš„å±æ€§ï¼ˆå¦‚ `_terms` è€Œä¸æ˜¯ `_term_regs`ï¼‰
  - æŸ¥é˜…å®˜æ–¹æ–‡æ¡£ç¡®è®¤APIå¯ç”¨æ€§

### 3. è°ƒè¯•æ–¹æ³•çš„é€‰æ‹©
- **æ•™è®­**ï¼š`env.logger` ä¸å­˜åœ¨ï¼Œä¸èƒ½ç”¨æ ‡å‡† logging æ–¹å¼è°ƒè¯•
- **æ›¿ä»£æ–¹æ¡ˆ**ï¼š
  - ä½¿ç”¨ `print()` è¾“å‡ºåˆ°æ§åˆ¶å°
  - ä¿®æ”¹metricè®¡ç®—è¿”å›è°ƒè¯•ä¿¡æ¯
  - ä½¿ç”¨ Isaac Lab çš„è°ƒè¯•å¯è§†åŒ–åŠŸèƒ½

### 4. é€åˆ†é¢˜æµ‹è¯•çš„ä»·å€¼
- **ä»·å€¼**ï¼šé€šè¿‡æç®€é…ç½®å¿«é€ŸéªŒè¯ç³»ç»Ÿé€»è¾‘
- **æ–¹æ³•**ï¼š
  1. è®¾ç½®æè¿‘è·ç¦»ç›®æ ‡ï¼ˆ0.1-0.5mï¼‰
  2. è®¾ç½®å·¨å¤§é˜ˆå€¼ï¼ˆ3.0mï¼‰
  3. è§‚å¯Ÿæ˜¯å¦100%æˆåŠŸ
- **æ„ä¹‰**ï¼šå¦‚æœå¤±è´¥ï¼Œè¯´æ˜å­˜åœ¨æ ¹æœ¬æ€§bugï¼ˆå¦‚åæ ‡ç³»ä¸ä¸€è‡´ï¼‰

---

## ğŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### çŸ­æœŸï¼ˆéªŒè¯ä¿®å¤ï¼‰
1. âœ… è¿è¡Œé€åˆ†é¢˜æµ‹è¯•ï¼ˆnum_envs=256ï¼‰
2. âœ… è§‚å¯Ÿ reach_goal æ˜¯å¦çªç ´ 0
3. âœ… å¦‚æœæˆåŠŸï¼Œæ¢å¤æ­£å¸¸è®­ç»ƒå‚æ•°

### ä¸­æœŸï¼ˆå‚æ•°ä¼˜åŒ–ï¼‰
1. é€æ­¥æ”¶ç´§é˜ˆå€¼ï¼š3.0m â†’ 1.5m â†’ 1.0m â†’ 0.5m
2. é€æ­¥æ‰©å¤§è·ç¦»ï¼š0.5m â†’ 1.0m â†’ 1.5m â†’ 2.0m
3. è§‚å¯ŸæˆåŠŸç‡ç¨³å®šåœ¨ 80%+

### é•¿æœŸï¼ˆæ¶æ„æ”¹è¿›ï¼‰
1. **å‚è€ƒè·¯å¾„å¼•å¯¼**ï¼ˆå€Ÿé‰´ NeuPANï¼‰ï¼š
   - æä¾›å‚è€ƒè½¨è¿¹è€Œééšæœºç›®æ ‡
   - å‡å°‘æ¢ç´¢éš¾åº¦

2. **æ™ºèƒ½ç›®æ ‡ç”Ÿæˆ**ï¼š
   - é¿å…ç”Ÿæˆåœ¨éšœç¢ç‰©åæ–¹
   - è€ƒè™‘æœºå™¨äººæœå‘

3. **ç‚¹çº§ç¢°æ’æ£€æµ‹**ï¼š
   - ä½¿ç”¨å‡ ä½•çº¦æŸè€Œéæƒ©ç½šå‡½æ•°
   - æé«˜å®‰å…¨æ€§

---

## ğŸ“ æ¶æ„å¸ˆæœ€ç»ˆè¯Šæ–­

**é—®é¢˜æœ¬è´¨**ï¼šåæ ‡ç³»ä¸ä¸€è‡´å¯¼è‡´åˆ¤å®šé€»è¾‘å¤±æ•ˆ

**è§£å†³æ–¹æ¡ˆ**ï¼šç»Ÿä¸€ä½¿ç”¨ `pose_command_w`ï¼ˆä¸–ç•Œåæ ‡ç³»ï¼‰

**æ ¸å¿ƒåŸåˆ™**ï¼š
1. **æ•°æ®æºä¸€è‡´æ€§**ï¼šmetricã€rewardã€termination å¿…é¡»ä½¿ç”¨ç›¸åŒçš„æ•°æ®æº
2. **APIç¨³å®šæ€§**ï¼šä¼˜å…ˆä½¿ç”¨å…¬å…±APIæˆ–ç¨³å®šçš„ç§æœ‰å±æ€§
3. **æ¸è¿›å¼éªŒè¯**ï¼šä»é€åˆ†é¢˜å¼€å§‹ï¼Œé€æ­¥å¢åŠ éš¾åº¦

**é¢„æœŸç»“æœ**ï¼š
- çŸ­æœŸï¼šreach_goal çªç ´ 0ï¼Œè¾¾åˆ° 80-100%
- ä¸­æœŸï¼šæˆåŠŸç‡ç¨³å®šåœ¨ 80%+ï¼Œå‚æ•°é€æ­¥æ”¶ç´§
- é•¿æœŸï¼šèåˆ NeuPAN æ€æƒ³ï¼Œå®ç°é«˜æ•ˆå¯¼èˆª

---

**ç»´æŠ¤è€…**: Claude Code AI Assistant
**æœ€åæ›´æ–°**: 2026-01-25 00:06:00
**çŠ¶æ€**: âœ… å·²è§£å†³å¹¶éªŒè¯
**Commit**: f892e9a
**é‡è¦æ€§**: ğŸ”´ ä¸¥é‡ - é˜»å¡è®­ç»ƒçš„æ ¹æœ¬æ€§Bug
**ä¸‹ä¸€æ­¥**: è¿è¡Œé€åˆ†é¢˜æµ‹è¯•éªŒè¯ä¿®å¤æ•ˆæœ
