# 问题记录：脚本用途误解

> **发现时间**: 2026-01-24 01:25:00
> **严重程度**: 🟢提示
> **状态**: ✅ 已解决
> **相关文件**: `play.py`, `train_v2.py`

---

## 问题描述

误解了 `play.py` 脚本的用途，导致错误的修改：

1. **错误理解 play.py**：以为是训练脚本，担心自动加载模型会阻止训练新模型
2. **错误修改**：添加了 `--resume` 参数，要求手动指定才加载
3. **不必要的 GPU 修改**：强制指定 `cuda:0`，破坏了 Isaac Lab 的自动设备管理

**实际用途**：
- `play.py` = 演示/测试脚本（用于查看训练好的模型效果）
- `train_v2.py` = 训练脚本（用于训练新模型）

---

## 根本原因

### 1. 直接原因
- 没有仔细阅读 `play.py` 的代码注释
- 看到自动加载模型，误以为是训练脚本
- 担心"更新策略后无法训练新模型"

### 2. 深层原因
- **缺少文档说明**：项目缺少 `README.md` 或脚本使用说明
- **命名不够清晰**：`play.py` 不够直观，应该叫 `demo.py` 或 `test_policy.py`
- **没有明确区分**：训练脚本和演示脚本没有清晰的标识

---

## 解决方案

### 方案A: 恢复原始逻辑（已采用）

**撤销所有修改**：
```bash
git reset --soft HEAD~1  # 撤销最近的commit
```

**恢复 play.py**：
- 移除 `--resume` 参数
- 恢复自动搜索最新模型的逻辑
- 添加清晰的注释说明用途

**恢复 train_v2.py**：
- 恢复 `env.unwrapped.device` 优先检测
- 让 Isaac Lab 自动管理设备
- 配置文件 `device: 'cuda:0'` 作为后备

---

## 实施步骤

1. **撤销错误修改**
   ```bash
   git reset --soft HEAD~1
   ```

2. **恢复 play.py 自动加载**
   ```python
   # 演示脚本：自动搜索并加载最新模型
   if args_cli.checkpoint:
       resume_path = args_cli.checkpoint
   else:
       # 自动搜索最新模型（无需 --resume 参数）
       resume_path = find_best_checkpoint(log_dir)
   ```

3. **恢复 train_v2.py 设备检测**
   ```python
   # 优先使用环境设备，配置文件作为后备
   device = env.unwrapped.device if hasattr(env.unwrapped, "device") else agent_cfg.get("device", "cuda:0")
   ```

4. **添加清晰的注释**
   - `play.py` 添加："# 演示/测试脚本：用于查看训练好的模型"
   - `train_v2.py` 添加："# 训练脚本：用于训练新模型"

5. **提交修复**
   ```bash
   git add -A
   git commit -m "revert: 恢复play.py自动加载逻辑和train_v2.py设备检测"
   ```

---

## 验证方法

### 验证 play.py

```bash
# 应该能直接运行，自动加载最新模型
~/IsaacLab/isaaclab.sh -p play.py --num_envs 1

# 预期输出：
# [INFO] 正在 logs/dashgo_nav_safe_v1 下搜索最新模型...
# [INFO] 自动锁定最佳模型: logs/dashgo_nav_safe_v1/run-xxx/model_450.pt
```

### 验证 train_v2.py

```bash
# 应该能自动使用 GPU（Isaac Lab 管理）
~/IsaacLab/isaaclab.sh -p train_v2.py --num_envs 16

# 预期：nvidia-smi 显示 GPU 利用率 > 50%
```

---

## 经验教训

### 1. 理解脚本用途再修改
- ❌ 错误：看到"自动加载模型"就认为是训练脚本
- ✅ 正确：先阅读代码和注释，理解脚本的真实用途

### 2. 不要过度修改
- ❌ 错误：修改设备检测逻辑（Isaac Lab 已经处理好了）
- ✅ 正确：只修改必要的部分，信任框架的默认行为

### 3. 命名应该清晰
- `play.py` → 建议改名为 `demo.py` 或 `test_policy.py`
- `train_v2.py` → 已经很清晰

### 4. 添加使用说明
应该在 `README.md` 中明确说明：
```markdown
## 脚本说明

### 训练新模型
```bash
~/IsaacLab/isaaclab.sh -p train_v2.py --num_envs 16
```

### 演示/测试已有模型
```bash
~/IsaacLab/isaaclab.sh -p play.py --num_envs 1
```
```

---

## 相关提交

- **commit**: `96fdb82` - revert: 恢复play.py自动加载逻辑和train_v2.py设备检测
- **commit**: `0ead889` - fix: 修复GPU利用率和自动加载问题（已撤销）

---

## 后续改进

### 建议创建的文档

1. **README.md** - 项目说明
   ```markdown
   # DashGo RL Navigation Project

   ## 脚本说明
   - `train_v2.py`: 训练脚本（用于训练新模型）
   - `play.py`: 演示脚本（用于查看训练好的模型）

   ## 快速开始
   ### 训练
   ~/IsaacLab/isaaclab.sh -p train_v2.py --num_envs 16

   ### 演示
   ~/IsaacLab/isaaclab.sh -p play.py --num_envs 1
   ```

2. **脚本使用文档** `docs/脚本使用指南.md`
   - 详细说明每个脚本的用途
   - 提供常用命令示例
   - 解释关键参数

---

**问题状态**: ✅ 已解决
**解决时间**: 2026-01-24 01:30
**验证方式**: ✅ 代码已恢复原逻辑，等待用户验证
**改进建议**: 创建 README.md 和脚本使用文档
