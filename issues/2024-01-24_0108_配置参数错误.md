# é—®é¢˜è®°å½•ï¼šé…ç½®å‚æ•°é”™è¯¯

> **å‘ç°æ—¶é—´**: 2026-01-24 17:02:00
> **ä¸¥é‡ç¨‹åº¦**: ğŸ”´ä¸¥é‡
> **çŠ¶æ€**: âœ… å·²è§£å†³
> **ç›¸å…³æ–‡ä»¶**: `train_cfg_v2.yaml`

---

## é—®é¢˜æè¿°

è¿è¡Œplay.pyæ—¶å‡ºç°FATALé”™è¯¯ï¼š

```
[FATAL] æœªæ•è·çš„å¼‚å¸¸: PPO.__init__() got an unexpected keyword argument 'learning_rate_schedule'
```

**é”™è¯¯ç°è±¡**:
- ç¨‹åºå¯åŠ¨æ—¶ç«‹å³å´©æºƒ
- æ— æ³•åŠ è½½è®­ç»ƒé…ç½®
- é˜»å¡æ‰€æœ‰è®­ç»ƒä»»åŠ¡

---

## é”™è¯¯ä¿¡æ¯

```python
[FATAL] æœªæ•è·çš„å¼‚å¸¸: PPO.__init__() got an unexpected keyword argument 'learning_rate_schedule'
```

**å®Œæ•´é”™è¯¯å †æ ˆ**:
```
Traceback (most recent call last):
  File "play.py", line X, in <module>
    main()
  File "play.py", line X, in main
    runner = OnPolicyRunner(env, agent_cfg, log_dir=log_dir, device=device)
  File ".../rsl_rl/runners/on_policy_runner.py", line X, in __init__
    self.algorithm = PPO(**algorithm_cfg)
TypeError: PPO.__init__() got an unexpected keyword argument 'learning_rate_schedule'
```

---

## æ ¹æœ¬åŸå› 

### 1. ç›´æ¥åŸå› 
åœ¨ `train_cfg_v2.yaml` ä¸­æ·»åŠ äº†RSL-RLçš„PPOä¸æ”¯æŒçš„å‚æ•°ï¼š
```yaml
learning_rate: 3.0e-4
learning_rate_schedule: linear  # âŒ PPOä¸æ”¯æŒ
lr_decay_fraction: 0.5         # âŒ PPOä¸æ”¯æŒ
```

### 2. æ·±å±‚åŸå› 
- **æœªéªŒè¯APIå°±æ·»åŠ å‚æ•°**: åŸºäºå‡è®¾æ·»åŠ äº†å‚æ•°ï¼Œæ²¡æœ‰å…ˆç”¨`inspect.signature()`éªŒè¯
- **è¿åé¡¹ç›®è§„åˆ™**: è¿åäº†"å®˜æ–¹æ–‡æ¡£ä¼˜å…ˆ"åŸåˆ™ï¼Œæ²¡æœ‰æŸ¥é˜…RSL-RLå®˜æ–¹æ–‡æ¡£
- **ç¼ºå°‘æµ‹è¯•**: ä¿®æ”¹é…ç½®åæ²¡æœ‰è¿è¡ŒéªŒè¯è„šæœ¬æµ‹è¯•

### 3. ä¸ºä»€ä¹ˆä¼šçŠ¯è¿™ä¸ªé”™è¯¯
- å‡è®¾å­¦ä¹ ç‡è°ƒåº¦æ˜¯"å¸¸è§åŠŸèƒ½"ï¼Œæ‰€æœ‰PPOå®ç°éƒ½åº”è¯¥æ”¯æŒ
- æ²¡æœ‰æ„è¯†åˆ°ä¸åŒRLåº“çš„å®ç°å·®å¼‚
- çœ‹åˆ°å…¶ä»–é¡¹ç›®æœ‰ç±»ä¼¼é…ç½®ï¼Œå°±ç›´æ¥å¤åˆ¶è¿‡æ¥

---

## è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆA: ç§»é™¤ä¸æ”¯æŒçš„å‚æ•°ï¼ˆå·²é‡‡ç”¨ï¼‰

**ä¿®æ”¹å‰**ï¼ˆtrain_cfg_v2.yaml:28-41ï¼‰:
```yaml
algorithm:
  class_name: PPO
  value_loss_coef: 1.0
  use_clipped_value_loss: True
  clip_param: 0.2
  num_learning_epochs: 5

  # [ä¼˜åŒ–] å­¦ä¹ ç‡è°ƒåº¦ï¼šä¿æŒåˆå§‹å€¼3e-4ï¼Œè®­ç»ƒæ—¶çº¿æ€§è¡°å‡
  learning_rate: 3.0e-4
  learning_rate_schedule: linear  # âŒ ä¸æ”¯æŒ
  lr_decay_fraction: 0.5  # âŒ ä¸æ”¯æŒ

  max_grad_norm: 1.0
  gamma: 0.99
  lam: 0.95
  desired_kl: 0.01
```

**ä¿®æ”¹å**:
```yaml
algorithm:
  class_name: PPO
  value_loss_coef: 1.0
  use_clipped_value_loss: True
  clip_param: 0.2
  num_learning_epochs: 5

  # [ä¼˜åŒ–] ä½¿ç”¨ä¿å®ˆçš„å­¦ä¹ ç‡æé«˜ç¨³å®šæ€§
  learning_rate: 1.0e-4  # é™ä½åˆ°ä¿å®ˆå€¼

  max_grad_norm: 1.0
  gamma: 0.99
  lam: 0.95
  desired_kl: 0.01
```

**å˜æ›´è¯´æ˜**:
- ç§»é™¤ `learning_rate_schedule: linear`
- ç§»é™¤ `lr_decay_fraction: 0.5`
- å­¦ä¹ ç‡ä» `3e-4` é™åˆ° `1e-4`ï¼ˆæ›´ä¿å®ˆï¼Œæ›´ç¨³å®šï¼‰

---

## å®æ–½æ­¥éª¤

1. **éªŒè¯å®é™…æ”¯æŒçš„å‚æ•°**
   ```bash
   python -c "from rsl_rl.algorithms import PPO; import inspect; print(inspect.signature(PPO.__init__))"
   ```

2. **ä¿®æ”¹é…ç½®æ–‡ä»¶**
   - ç¼–è¾‘ `train_cfg_v2.yaml`
   - ç§»é™¤ä¸æ”¯æŒçš„å‚æ•°
   - é™ä½å­¦ä¹ ç‡åˆ°ä¿å®ˆå€¼

3. **æäº¤ä¿®å¤**
   ```bash
   git add train_cfg_v2.yaml
   git commit -m "fix: ç§»é™¤ä¸æ”¯æŒçš„å­¦ä¹ ç‡è°ƒåº¦å‚æ•°"
   ```

4. **éªŒè¯ä¿®å¤**
   ```bash
   ~/IsaacLab/isaaclab.sh -p play.py --num_envs 1
   # åº”è¯¥èƒ½æ­£å¸¸å¯åŠ¨
   ```

---

## éªŒè¯æ–¹æ³•

### è‡ªåŠ¨éªŒè¯
ä½¿ç”¨ `check_config.py` è„šæœ¬ï¼š
```bash
python check_config.py
# åº”è¯¥è¾“å‡º: âœ“ æ‰€æœ‰algorithmå‚æ•°éƒ½æœ‰æ•ˆï¼
```

### æ‰‹åŠ¨éªŒè¯
1. è¿è¡Œè®­ç»ƒè„šæœ¬
2. è§‚å¯Ÿæ˜¯å¦è¿˜æœ‰ "unexpected keyword argument" é”™è¯¯
3. æ£€æŸ¥PPOæ˜¯å¦æˆåŠŸåˆå§‹åŒ–

---

## ç»éªŒæ•™è®­

### 1. æ°¸è¿œä¸è¦å‡è®¾APIæ”¯æŒæŸå‚æ•°
- âŒ é”™è¯¯åšæ³•: "åº”è¯¥æ”¯æŒå­¦ä¹ ç‡è°ƒåº¦å§ï¼ŒåŠ ä¸Šè¯•è¯•"
- âœ… æ­£ç¡®åšæ³•: å…ˆç”¨`inspect.signature()`éªŒè¯æ”¯æŒçš„å‚æ•°

### 2. éµå®ˆ"å®˜æ–¹æ–‡æ¡£ä¼˜å…ˆ"åŸåˆ™
- âŒ é”™è¯¯åšæ³•: çœ‹åˆ°å…¶ä»–é¡¹ç›®æœ‰è¿™ä¸ªé…ç½®ï¼Œæˆ‘ä¹ŸåŠ 
- âœ… æ­£ç¡®åšæ³•: æŸ¥é˜…å®˜æ–¹æ–‡æ¡£ç¡®è®¤å‚æ•°æ”¯æŒ

### 3. ä¿®æ”¹é…ç½®åå¿…é¡»éªŒè¯
- âŒ é”™è¯¯åšæ³•: ä¿®æ”¹é…ç½®ç›´æ¥è¿è¡Œ
- âœ… æ­£ç¡®åšæ³•: è¿è¡ŒéªŒè¯è„šæœ¬æµ‹è¯•é…ç½®æœ‰æ•ˆæ€§

### 4. ä¿å®ˆçš„å­¦ä¹ ç‡ç­–ç•¥
- âŒ é”™è¯¯åšæ³•: ä½¿ç”¨æ¨èå€¼çš„ä¸Šç•Œï¼ˆ3e-4ï¼‰
- âœ… æ­£ç¡®åšæ³•: ä»ä¿å®ˆå€¼å¼€å§‹ï¼ˆ1e-4ï¼‰ï¼Œé€æ­¥è°ƒè¯•

---

## ç›¸å…³æäº¤

- **commit**: `5febabc` - fix: ç§»é™¤ä¸æ”¯æŒçš„å­¦ä¹ ç‡è°ƒåº¦å‚æ•°
- **commit**: `fe7db12` - test: æ·»åŠ é…ç½®å‚æ•°éªŒè¯è„šæœ¬

---

## é˜²æ­¢å†æ¬¡å‘ç”Ÿ

### é¡¹ç›®è§„åˆ™æ›´æ–°
å·²æ›´æ–° `.claude/rules/project-specific-rules.md`ï¼Œæ·»åŠ ï¼š

```markdown
## ğŸ”§ é…ç½®ä¿®æ”¹è§„èŒƒ

### ä¸¥ç¦æœªç»éªŒè¯çš„å‚æ•°æ·»åŠ 
1. ä¿®æ”¹é…ç½®å‰å¿…é¡»ä½¿ç”¨`inspect.signature()`éªŒè¯å‚æ•°
2. æŸ¥é˜…å®˜æ–¹æ–‡æ¡£ç¡®è®¤å‚æ•°æ”¯æŒ
3. è¿è¡ŒéªŒè¯è„šæœ¬æµ‹è¯•é…ç½®æœ‰æ•ˆæ€§
```

### åˆ›å»ºéªŒè¯è„šæœ¬
å·²åˆ›å»º `check_config.py`ï¼š
- éªŒè¯algorithmé…ç½®å‚æ•°
- éªŒè¯policyé…ç½®å‚æ•°
- éªŒè¯environmenté…ç½®

æ¯æ¬¡ä¿®æ”¹é…ç½®åè¿è¡Œï¼š
```bash
python check_config.py
```

---

## åç»­ä¼˜åŒ–

### å¯é€‰æ”¹è¿›ï¼ˆå·²è®°å½•ï¼Œæœªå®æ–½ï¼‰
1. **å®ç°è‡ªå®šä¹‰å­¦ä¹ ç‡è°ƒåº¦**
   - åœ¨è®­ç»ƒå¾ªç¯ä¸­æ‰‹åŠ¨è¡°å‡å­¦ä¹ ç‡
   - å‚è€ƒRSL-RLå®˜æ–¹ç¤ºä¾‹

2. **ä½¿ç”¨å­¦ä¹ ç‡é¢„çƒ­**
   - å‰Nä¸ªiterationä½¿ç”¨è¾ƒå°å­¦ä¹ ç‡
   - ç„¶ååˆ‡æ¢åˆ°æ­£å¸¸å­¦ä¹ ç‡

3. **ä½¿ç”¨Cosineé€€ç«**
   - å®ç°è‡ªå®šä¹‰çš„å­¦ä¹ ç‡è°ƒåº¦å™¨
   - éœ€è¦ä¿®æ”¹RSL-RLè®­ç»ƒå™¨

**æ³¨æ„**: è¿™äº›éƒ½éœ€è¦ä¿®æ”¹RSLRLæºç æˆ–è®­ç»ƒå¾ªç¯ï¼Œå±äºé«˜çº§ä¼˜åŒ–ã€‚

---

**é—®é¢˜çŠ¶æ€**: âœ… å·²è§£å†³
**è§£å†³æ—¶é—´**: 2026-01-24 17:05
**éªŒè¯æ–¹å¼**: æˆåŠŸè¿è¡Œplay.py
