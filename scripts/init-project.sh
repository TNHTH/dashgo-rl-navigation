#!/bin/bash
# é¡¹ç›®åˆå§‹åŒ–è„šæœ¬
# ç”¨æ³•: ./scripts/init-project.sh "é¡¹ç›®åç§°"

PROJECT_NAME=$1

if [ -z "$PROJECT_NAME" ]; then
  echo "âŒ é”™è¯¯: è¯·æä¾›é¡¹ç›®åç§°"
  echo ""
  echo "ç”¨æ³•: ./scripts/init-project.sh <é¡¹ç›®åç§°>"
  echo "ç¤ºä¾‹: ./scripts/init-project.sh \"ä»»åŠ¡ç®¡ç†App\""
  exit 1
fi

echo "ğŸš€ åˆå§‹åŒ–é¡¹ç›®: $PROJECT_NAME"
echo ""

# ========================================
# 1. åˆ›å»ºç›®å½•ç»“æ„
# ========================================
echo "ğŸ“ åˆ›å»ºç›®å½•ç»“æ„..."

mkdir -p .artifacts/phase{1..5}
mkdir -p .artifacts/security
mkdir -p .backups
mkdir -p docs
mkdir -p scripts

echo "âœ… ç›®å½•ç»“æ„å·²åˆ›å»º"

# ========================================
# 2. åˆ›å»ºINDEX.md
# ========================================
echo "ğŸ“ åˆ›å»ºINDEX.md..."

cat > docs/INDEX.md <<EOF
# é¡¹ç›®Artifactç´¢å¼•

> **é¡¹ç›®åç§°**: $PROJECT_NAME
> **åˆ›å»ºæ—¶é—´**: $(date +%Y-%m-%d)
> **å½“å‰é˜¶æ®µ**: é¡¹ç›®å¯åŠ¨

---

## ğŸ“Š è¿›åº¦æ¦‚è§ˆ

\`\`\`yaml
project:
  name: "$PROJECT_NAME"
  status: "åˆå§‹åŒ–"
  started: "$(date +%Y-%m-%d)"

progress:
  phase1: â³ å¾…å¼€å§‹ - éœ€æ±‚åˆ†æ
  phase2: â³ å¾…å¼€å§‹ - æ¶æ„è®¾è®¡
  phase3: â³ å¾…å¼€å§‹ - è¿­ä»£å¼€å‘
  phase4: â³ å¾…å¼€å§‹ - æµ‹è¯•éªŒè¯
  phase5: â³ å¾…å¼€å§‹ - éƒ¨ç½²ä¸Šçº¿
\`\`\`

---

## ğŸ“ Artifacts

### é˜¶æ®µ1ï¼šéœ€æ±‚åˆ†æ â³ å¾…å¼€å§‹
- çŠ¶æ€: æœªå¼€å§‹

### é˜¶æ®µ2ï¼šæ¶æ„è®¾è®¡ â³ å¾…å¼€å§‹
- çŠ¶æ€: æœªå¼€å§‹

### é˜¶æ®µ3ï¼šè¿­ä»£å¼€å‘ â³ å¾…å¼€å§‹
#### 3a. åç«¯å¼€å‘
- çŠ¶æ€: æœªå¼€å§‹

#### 3b. å‰ç«¯å¼€å‘
- çŠ¶æ€: æœªå¼€å§‹

#### 3c. é›†æˆè°ƒè¯•
- çŠ¶æ€: æœªå¼€å§‹

### é˜¶æ®µ4ï¼šæµ‹è¯•éªŒè¯ â³ å¾…å¼€å§‹
- çŠ¶æ€: æœªå¼€å§‹

### é˜¶æ®µ5ï¼šéƒ¨ç½²ä¸Šçº¿ â³ å¾…å¼€å§‹
- çŠ¶æ€: æœªå¼€å§‹

---

## ğŸ›¡ï¸ å®‰å…¨å®¡è®¡

æš‚æ— å®‰å…¨å®¡è®¡è®°å½•ã€‚

---

## ğŸ“¦ å¤‡ä»½å†å²

æš‚æ— å¤‡ä»½è®°å½•ã€‚

---

## ğŸ”§ ç»´æŠ¤è¯´æ˜

### INDEX.mdæ›´æ–°è§„åˆ™
- æ¯ä¸ªAgentä»»åŠ¡å®Œæˆåè‡ªåŠ¨æ›´æ–°
- è®°å½•æ‰€æœ‰ç”Ÿæˆçš„artifactsè·¯å¾„
- æ›´æ–°è¿›åº¦çŠ¶æ€

### å¤‡ä»½è§„åˆ™
- æœ¬åœ°å¿«ç…§: \`.backups/phase-X-[timestamp]/\`
- Git commit: å¦‚æœGitå¯ç”¨
- è¿œç¨‹å¤‡ä»½: å¯é€‰

---

**æœ€åæ›´æ–°**: $(date)
**ç»´æŠ¤è€…**: Claude Code AI Agent System
EOF

echo "âœ… INDEX.mdå·²åˆ›å»º"

# ========================================
# 3. åˆå§‹åŒ–Gitï¼ˆå¦‚æœéœ€è¦ï¼‰
# ========================================
echo ""
echo "ğŸ”§ æ£€æŸ¥GitçŠ¶æ€..."

if git rev-parse --git-dir > /dev/null 2>&1; then
  echo "âœ… Gitä»“åº“å·²å­˜åœ¨"
  echo "   å½“å‰åˆ†æ”¯: $(git branch --show-current 2>/dev/null || echo 'N/A')"
else
  echo "âš ï¸  æœªæ£€æµ‹åˆ°Gitä»“åº“"
  echo ""
  read -p "æ˜¯å¦åˆå§‹åŒ–Gitä»“åº“ï¼Ÿ[y/N]: " init_git

  if [ "$init_git" == "y" ] || [ "$init_git" == "Y" ]; then
    git init
    echo ".artifacts/" >> .gitignore
    echo ".backups/" >> .gitignore
    git add .
    git commit -m "chore: initialize project $PROJECT_NAME"
    echo "âœ… Gitä»“åº“å·²åˆå§‹åŒ–"
  else
    echo "â­ï¸  è·³è¿‡Gitåˆå§‹åŒ–"
  fi
fi

# ========================================
# 4. åˆ›å»ºREADME
# ========================================
echo ""
echo "ğŸ“– åˆ›å»ºREADME.md..."

cat > README.md <<EOF
# $PROJECT_NAME

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®ä½¿ç”¨ **Claude Code æ™ºèƒ½Agentå·¥ä½œæµç³»ç»Ÿ** å¼€å‘ã€‚

## å¼€å‘é˜¶æ®µ

- [ ] é˜¶æ®µ1: éœ€æ±‚åˆ†æ
- [ ] é˜¶æ®µ2: æ¶æ„è®¾è®¡
- [ ] é˜¶æ®µ3: è¿­ä»£å¼€å‘
  - [ ] 3a. åç«¯å¼€å‘
  - [ ] 3b. å‰ç«¯å¼€å‘
  - [ ] 3c. é›†æˆè°ƒè¯•
- [ ] é˜¶æ®µ4: æµ‹è¯•éªŒè¯
- [ ] é˜¶æ®µ5: éƒ¨ç½²ä¸Šçº¿

## Artifactsç´¢å¼•

æ‰€æœ‰é¡¹ç›®äº§ç‰©ï¼ˆéœ€æ±‚æ–‡æ¡£ã€æ¶æ„è®¾è®¡ã€ä»£ç ç­‰ï¼‰çš„ç´¢å¼•è¯·æŸ¥çœ‹ï¼š
- **[docs/INDEX.md](docs/INDEX.md)** - å®Œæ•´çš„Artifactåœ°å›¾

## å¤‡ä»½ä¸å›æ»š

### æŸ¥çœ‹å¯ç”¨å¤‡ä»½
\`\`\`bash
./scripts/list-backups.sh
\`\`\`

### å›æ»šåˆ°æŒ‡å®šå¤‡ä»½
\`\`\`bash
# æœ¬åœ°å¿«ç…§å›æ»š
./scripts/rollback.sh .backups/phase-X-TIMESTAMP

# Gitå›æ»šï¼ˆå¦‚æœGitå¯ç”¨ï¼‰
./scripts/rollback.sh git 1
\`\`\`

### åˆ›å»ºå¤‡ä»½ç‚¹
\`\`\`bash
./scripts/backup-phase.sh phase1 agent-name
\`\`\`

## å¿«é€Ÿå¼€å§‹

1. **å¯åŠ¨Claude Code**
   \`\`\`bash
   claude
   \`\`\`

2. **æè¿°é¡¹ç›®éœ€æ±‚**
   \`\`\`
   æˆ‘è¦å¼€å‘ä¸€ä¸ª[é¡¹ç›®æè¿°]
   \`\`\`

3. **ç³»ç»Ÿè‡ªåŠ¨è¯†åˆ«Agentå¹¶å¼€å§‹å·¥ä½œ**

## æŠ€æœ¯æ ˆ

å¾…é˜¶æ®µ2æ¶æ„è®¾è®¡å®Œæˆåæ›´æ–°ã€‚

## é¡¹ç›®ç»“æ„

\`\`\`
$PROJECT_NAME/
â”œâ”€â”€ .artifacts/          # æ‰€æœ‰Agentç”Ÿæˆçš„äº§ç‰©
â”‚   â”œâ”€â”€ phase1-product/  # éœ€æ±‚åˆ†æäº§ç‰©
â”‚   â”œâ”€â”€ phase2-architecture/ # æ¶æ„è®¾è®¡äº§ç‰©
â”‚   â”œâ”€â”€ phase3-backend/  # åç«¯å¼€å‘äº§ç‰©
â”‚   â”œâ”€â”€ phase3-frontend/ # å‰ç«¯å¼€å‘äº§ç‰©
â”‚   â”œâ”€â”€ phase3-integration/ # é›†æˆè°ƒè¯•äº§ç‰©
â”‚   â”œâ”€â”€ phase4-testing/  # æµ‹è¯•éªŒè¯äº§ç‰©
â”‚   â”œâ”€â”€ phase5-deployment/ # éƒ¨ç½²ä¸Šçº¿äº§ç‰©
â”‚   â””â”€â”€ security/        # å®‰å…¨å®¡è®¡æŠ¥å‘Š
â”œâ”€â”€ .backups/            # å¤‡ä»½å¿«ç…§
â”œâ”€â”€ docs/                # é¡¹ç›®æ–‡æ¡£
â”‚   â””â”€â”€ INDEX.md         # Artifactç´¢å¼•
â”œâ”€â”€ scripts/             # å·¥å…·è„šæœ¬
â”‚   â”œâ”€â”€ init-project.sh  # é¡¹ç›®åˆå§‹åŒ–
â”‚   â”œâ”€â”€ backup-phase.sh  # åˆ›å»ºå¤‡ä»½
â”‚   â”œâ”€â”€ rollback.sh      # å›æ»š
â”‚   â””â”€â”€ list-backups.sh  # åˆ—å‡ºå¤‡ä»½
â””â”€â”€ README.md            # æœ¬æ–‡ä»¶
\`\`\`

---

**åˆ›å»ºæ—¶é—´**: $(date)
**å·¥å…·ç³»ç»Ÿ**: Claude Code æ™ºèƒ½Agentå·¥ä½œæµ v3.0
EOF

echo "âœ… README.mdå·²åˆ›å»º"

# ========================================
# 5. å®Œæˆ
# ========================================
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "âœ… é¡¹ç›®åˆå§‹åŒ–å®Œæˆï¼"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ğŸ“‚ é¡¹ç›®ä½ç½®: $(pwd)"
echo "ğŸ“ é¡¹ç›®åç§°: $PROJECT_NAME"
echo ""
echo "ğŸ¯ ä¸‹ä¸€æ­¥æ“ä½œï¼š"
echo "1. å¯åŠ¨Claude Code:"
echo "   claude"
echo ""
echo "2. åœ¨Claude Codeä¸­æè¿°é¡¹ç›®éœ€æ±‚ï¼Œä¾‹å¦‚ï¼š"
echo ""
echo "   æˆ‘è¦å¼€å‘ä¸€ä¸ª$PROJECT_NAMEï¼Œæ ¸å¿ƒåŠŸèƒ½æ˜¯..."
echo ""
echo "3. ç³»ç»Ÿå°†è‡ªåŠ¨è¯†åˆ«Agentå¹¶å¼€å§‹å·¥ä½œ"
echo ""
echo "ğŸ“š å‚è€ƒæ–‡æ¡£:"
echo "   - docs/INDEX.md - Artifactç´¢å¼•"
echo "   - README.md - é¡¹ç›®è¯´æ˜"
echo ""
echo "ğŸ› ï¸  å¯ç”¨å‘½ä»¤:"
echo "   ./scripts/list-backups.sh    # æŸ¥çœ‹å¤‡ä»½"
echo "   ./scripts/backup-phase.sh phase1 product-agent  # åˆ›å»ºå¤‡ä»½"
echo "   ./scripts/rollback.sh .backups/phase-X-TIMESTAMP  # å›æ»š"
echo ""
