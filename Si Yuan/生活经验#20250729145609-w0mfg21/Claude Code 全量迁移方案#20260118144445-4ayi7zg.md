这是一个基于**第一性原理**构建的完整迁移方案。我们将此任务分解为三个核心层级：**环境复刻（Environment）** 、**状态迁移（State）**  和 **路径重映射（Path Mapping）** 。

这份方案专为你设计，包含自动化脚本，旨在一次性打通 Windows 到 Ubuntu 的“任督二脉”。

---

# 🚀 Claude Code 全量迁移方案 (Windows → Ubuntu)

**目标**：将 Windows (`D:\cursor\...`) 下配置完美的 Claude Code 环境（含自定义 API、MCP 工具、历史记忆）无缝移植到 Ubuntu。

## 📋 第一阶段：源端提取 (Windows)

我们需要提取“大脑”（配置）和“手脚”（工具脚本）。

### 1. 提取配置文件

在 Windows 资源管理器中找到以下核心文件（通常在 `%APPDATA%` 或用户主目录）：

* **路径**：`C:\Users\你的用户名\.claude\` (或 `AppData\Roaming\Code\User\globalStorage\下面的claude文件夹`)
* **目标文件**：

  * `config.json` (核心配置，含 API Key 和 URL)
  * `mcp_settings.json` (MCP 工具注册表)
  * `history.db` 或 `sessions/` (如果有，保留对话记忆)

### 2. 提取 MCP 工具库

* **路径**：`D:\cursor\file\` (根据你之前的截图)
* **操作**：将包含你所有 Python/Node.js MCP 脚本的整个文件夹打包。

**建议**：将上述所有内容放入一个名为 `migration_pack` 的文件夹中，通过 U盘或 SCP 传输到 Ubuntu。

---

## 🛠️ 第二阶段：环境构建 (Ubuntu)

在目标机器上重建基础设施。

### 1. 基础依赖安装 (阿里/清华源优化)

Bash

```
# 1. 更新并安装系统级依赖
sudo apt update && sudo apt install -y nodejs npm python3 python3-pip python3-venv

# 2. 安装 Claude Code (使用淘宝源，防卡死)
sudo npm install -g @anthropic-ai/claude-code --registry=https://registry.npmmirror.com

# 3. 修正 npm 权限 (避免后续 sudo 运行)
sudo chown -R $USER /usr/local/lib/node_modules
sudo chown -R $USER /usr/local/bin
```

### 2. 部署 MCP 工具代码

建议在 Ubuntu 建立规范的目录结构（不要放在桌面）：

Bash

```
# 创建标准工作区
mkdir -p ~/claude_workspace/mcp_tools

# 将你从 Windows 带来的 MCP 脚本解压/复制到这里
# 假设复制后路径为: /home/你的用户名/claude_workspace/mcp_tools/
```

### 3. 恢复 Python 依赖

如果你的 MCP 工具用了 pandas, requests 等库：

Bash

```
# 建议使用 venv 隔离环境（最佳实践）
python3 -m venv ~/claude_workspace/venv
source ~/claude_workspace/venv/bin/activate

# 安装依赖 (根据你之前的项目推测)
pip install requests pandas numpy -i https://pypi.tuna.tsinghua.edu.cn/simple
```

---

## 🧬 第三阶段：神经缝合 (配置移植与修正)

这是最关键的一步。我们需要把 Windows 的配置“翻译”成 Linux 能读懂的格式。

### 1. 放置配置文件

Linux 下 Claude Code 的默认配置路径通常在 `~/.claude/` 或 `~/.config/claude/`。

Bash

```
# 运行一次初始化以生成目录，然后立即退出
claude
# (按 Ctrl+C 退出)

# 覆盖配置 (假设你的备份文件在 ~/Downloads/migration_pack/)
cp ~/Downloads/migration_pack/config.json ~/.claude/
cp ~/Downloads/migration_pack/mcp_settings.json ~/.claude/
```

### 2. 自动化路径重映射 (核心魔法) ⚡

Windows 路径 (`D:\\cursor\\...`) 在 Linux 下会报错。我们使用 `sed` 命令批量修复，比手动改更准。

**请根据实际情况修改下面的** **​`OLD_PATH`​** **和** **​`NEW_PATH`​**​ **，然后在终端执行：**

Bash

```
# 定义变量
# Windows 里的路径 (注意反斜杠需要转义)
OLD_PATH='D:\\\\cursor\\\\file'
# Ubuntu 里的新路径
NEW_PATH='/home/你的用户名/claude_workspace/mcp_tools'

# 1. 修正 mcp_settings.json 中的路径
sed -i "s|$OLD_PATH|$NEW_PATH|g" ~/.claude/mcp_settings.json

# 2. 将 "python" 替换为 "python3" (Linux 必须)
sed -i 's/"python"/"python3"/g' ~/.claude/mcp_settings.json

# 3. 将 Windows 反斜杠 "\" 替换为 Linux 正斜杠 "/"
sed -i 's|\\\\|/|g' ~/.claude/mcp_settings.json
```

### 3. 注入环境变量 (API 配置)

如果你的中转 API 是通过环境变量配置的，写入 `.bashrc`：

Bash

```
echo '' >> ~/.bashrc
echo '# Claude Code Configuration' >> ~/.bashrc
echo 'export CLAUDE_BASE_URL="https://你的中转域名/v1"' >> ~/.bashrc
echo 'export CLAUDE_API_KEY="你的sk-key"' >> ~/.bashrc
source ~/.bashrc
```

---

## ✅ 第四阶段：功能验证

执行以下检查清单，确保移植成功。

1. **启动测试**：
   Bash

   ```
   claude
   ```

   *预期*：直接进入交互界面，不提示登录（如果 token 迁移成功）或仅需简单重新授权。
2. 记忆测试：
   输入：/config
   预期：应该能看到你之前设置的 API URL 和其他偏好。
3. MCP 工具测试：
   输入：help 或直接询问需要调用工具的问题（例如：“运行一下之前的那个数据分析脚本”）。
   预期：Claude 能够成功调用 Python3 执行 /home/... 下的脚本，且没有 Command not found 错误。

## 🚑 常见故障排除

* 报错 Permission denied：
  你的脚本可能没有执行权限。
* 报错 Module not found：
  说明 Python 环境没对齐。在 mcp\_settings.json 中，将 python3 改为虚拟环境的绝对路径：/home/用户名/claude\_workspace/venv/bin/python。
