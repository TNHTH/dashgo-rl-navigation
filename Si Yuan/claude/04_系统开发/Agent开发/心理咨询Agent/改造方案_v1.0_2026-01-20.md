# 心理咨询Agent改造方案

**创建日期**: 2026-01-20
**状态**: 设计阶段
**目标**: 将 `self-reflection-agent` (Skill) 改造为真正的 `psychological-counselor` (Agent)

---

## 问题诊断

### 当前问题
- `self-reflection-agent` 是 **Skill**，不是 **Agent**
- Skill需要用户手动调用 `/analyze`
- **不会自动触发**，无法主动研究
- 缺少主动探索用户数据的能力

### 根本原因
- 混淆了Skill和Agent的概念
- Skill = 用户手动调用的工具
- Agent = AI可以主动启动的自主实体

---

## 改造目标

### 核心能力
1. **主动研究能力**
   - 自动扫描用户的日记、分析报告
   - 识别需要深入分析的主题
   - 主动发现模式和关联

2. **长期人格分析**
   - Big Five 五大人格模型
   - MBTI 深度分析（认知功能）
   - 时间维度上的变化追踪

3. **精准情感引导**
   - CBT认知扭曲识别
   - 苏格拉底式提问引导
   - 斯多葛哲学智慧引用

4. **结构化数据分析**
   - Markdown文件解析
   - 时间序列分析
   - 交叉验证不同来源的数据

---

## 技术架构

### Agent定义文件

**位置**: `multi-agent-system/agents/psychological-counselor.prompt.md`

**参考模板**: `architect.prompt.md` 或 `code-reviewer.prompt.md`

**核心结构**:
```markdown
# 心理咨询师 Agent

你是专业的心理咨询师和心理分析师，具备主动研究能力。

## 你的职责

1. **主动数据探索**
2. **人格深度分析**
3. **认知扭曲识别**
4. **情感引导与建议**
...
```

---

## 主动研究能力设计

### 1. 自动数据收集

**触发条件**:
- 用户提到任何情感、人格、关系问题
- 定期主动分析（如每周/每月）

**数据来源**:
```
Si Yuan/
├── 个人分析/
│   ├── 综合分析报告
│   ├── 心理分析报告
│   └── MBTI分析
├── 日记/
│   └── *.md (48个日记文件)
├── 周记/
│   └── *.md (8个周记文件)
└── 思维导图/
    └── *.md
```

**探索策略**:
- 使用 `Glob` 找到所有markdown文件
- 使用 `Grep` 搜索关键词（情绪、关系、冲突）
- 使用 `Read` 读取关键文件
- 时间戳分析（文件名包含日期）

### 2. 模式识别

**识别目标**:
- **情绪模式**: 频繁出现的情绪词
- **认知扭曲**: 读心术、灾难化、过度泛化
- **行为循环**: 触发器→行为→奖励
- **关系模式**: 与谁互动最多？正面/负面？

**技术手段**:
```python
# 伪代码示例
for file in diary_files:
    content = read(file)
    emotions = extract_emotions(content)
    distortions = detect_cognitive_distortions(content)
    relationships = extract_relationships(content)
    add_to_timeline(emotions, distortions, relationships)
```

### 3. 长期追踪

**时间维度**:
- 按月分析情绪变化
- 识别关键转折点
- 追踪成长轨迹

**输出**:
```markdown
## 情绪时间线

| 月份 | 主要情绪 | 触发事件 | 认知扭曲 |
|------|---------|---------|---------|
| 2024-07 | 焦虑 | 实验室压力 | 灾难化 |
| 2024-08 | 羞涩 | 王佳楼互动 | 读心术 |
| 2024-09 | - | - | - |
```

---

## CBT框架集成

### 1. 认知扭曲识别

**10种常见扭曲**:
1. 读心术（Mind Reading）
2. 灾难化（Catastrophizing）
3. 过度泛化（Overgeneralization）
4. 标签化（Labeling）
5. 非黑即白（All-or-Nothing Thinking）
6. 忽视积极（Disqualifying the Positive）
7. 应该陈述（Should Statements）
8. 个人化（Personalization）
9. 情绪推理（Emotional Reasoning）
10. 最小化/最大化（Minimizing/Maximizing）

**识别方法**:
- 扫描日记中的关键词
- 分析句式结构（"我应该"、"肯定"、"永远"）
- 结合上下文判断

**示例**:
```
用户原文: "我猜测她有男朋友了"
检测到: 读心术
证据: 没有验证，基于猜测
```

### 2. 苏格拉底式提问

**目标**: 不是给答案，而是引导思考

**提问模板**:
```markdown
## 关于"读心术"的苏格拉底提问

1. **证据问题**: "你有什么证据支持这个想法？"
2. **替代解释**: "还有什么其他可能性？"
3. **后果分析**: "如果这个想法是真的，会怎样？如果假的呢？"
4. **行动方案**: "你现在能做什么来验证？"
```

### 3. CBT工作表

**结构化输出**:
```markdown
## CBT认知重构工作表

### 情境
- 时间: 2026-01-02
- 事件: 王佳楼借行李箱

### 自动思维
- "她应该找我妈妈，不应该找我"
- "她段位太高"

### 认知扭曲
- 读心术（猜测她怎么想）
- 标签化（段位太高）

### 苏格拉底式提问
1. 🤔 她特意找你，说明了什么？
2. 🤔 "段位"的标准是什么？
3. 🤔 有没有证据表明她"段位高"？

### 替代思维
- "她特意找我，可能觉得和我说话更轻松"
- "段位高=好看+开朗，这也是我的优势"

### 行动实验
- [ ] 下次见到她，主动打招呼
- [ ] 寒假带小礼物回去
- [ ] 问叔叔她最近是否有男朋友
```

---

## 斯多葛哲学语料库

### 1. 核心原则

**控制二分法**:
- 控制你能控制的（你的想法、行动）
- 接受你不能控制的（别人的想法、结果）

**应用示例**:
```markdown
## 斯多葛视角：王佳楼关系

### 你能控制的
✅ 你的行动（主动打招呼、验证猜测）
✅ 你的想法（停止灾难化想象）
✅ 你的准备（提升自己）

### 你不能控制的
❌ 她是否有男朋友
❌ 她对你的看法
❌ 未来关系走向

### 斯多葛建议
"专注于你能控制的。行动起来，验证你的假设。"
"接受所有可能的结果，无论好坏。"
```

### 2. 语料库来源

**推荐引用**:
- 爱比克泰德《手册》
- 马可·奥勒留《沉思录》
- 塞内卡《论生命的短暂》

**集成方式**:
```markdown
## 智慧引用

**爱比克泰德**:
"人不是被事物本身困扰，而是被他们对事物的看法困扰。"

**应用**:
- "她有男朋友"（事实）不困扰你
- "我会没人要"（看法）困扰你
- 改变看法，而不是改变事实
```

---

## 工作流程设计

### 场景1：用户主动提问

**流程**:
```
1. 用户问题（如"王佳楼"关系分析）
2. Agent自动扫描相关数据
   - 读取王佳楼相关日记
   - 读取人名提取报告
   - 读取心理分析报告
3. 生成CBT分析
   - 识别认知扭曲
   - 苏格拉底式提问
   - 斯多葛建议
4. 输出结构化报告
```

### 场景2：Agent主动分析

**触发条件**:
- 新增日记文件
- 定期分析（每周/每月）
- 用户请求"全面分析"

**流程**:
```
1. 扫描Si Yuan目录
2. 识别新增/更新文件
3. 时间序列分析
4. 模式识别
5. 生成报告
6. 追踪变化（对比上次分析）
```

---

## 文件结构

```
multi-agent-system/
├── agents/
│   └── psychological-counselor.prompt.md  # 新建
├── shared/
│   └── cbt-framework.md                   # 新建：CBT框架文档
└── .claude/
    └── skills/
        └── psychological-analysis.json    # 保留：快速Skill版本
```

---

## 调用方式

### 方式1：通过Task工具（Agent）
```
用户: "分析一下王佳楼关系"
我: Task(subagent_type="psychological-counselor",
         prompt="分析王佳楼关系，基于所有日记和分析报告")
```

### 方式2：通过Skill（快速版本）
```
用户: /analyze data_path="Si Yuan" analysis_type="emotions"
```

---

## 与现有Agent的协作

### 与 Explore Agent
- Explore负责扫描代码库
- Psychological-Counselor负责分析个人数据

### 与 general-purpose Agent
- general-purpose负责复杂搜索
- Psychological-Counselor专门处理心理分析

---

## 实施步骤

### Phase 1: 核心框架
- [x] 设计Agent架构
- [ ] 创建 `psychological-counselor.prompt.md`
- [ ] 创建 `cbt-framework.md`
- [ ] 定义工作流程

### Phase 2: 数据分析能力
- [ ] 实现Markdown解析
- [ ] 实现情绪识别
- [ ] 实现认知扭曲检测
- [ ] 实现时间序列分析

### Phase 3: 引导能力
- [ ] 集成CBT工作表
- [ ] 实现苏格拉底式提问
- [ ] 集成斯多葛语料库

### Phase 4: 测试与优化
- [ ] 王佳楼案例分析
- [ ] INTJ人格分析
- [ ] 长期追踪测试

---

## 成功标准

### 功能完整性
- ✅ 能自动扫描用户数据
- ✅ 能识别认知扭曲
- ✅ 能提供CBT干预
- ✅ 能引用斯多葛哲学

### 主动性
- ✅ 无需用户手动触发
- ✅ 我可以主动调用
- ✅ 主动发现模式

### 专业性
- ✅ 基于实证心理学（CBT、Big Five）
- ✅ 避免泛化理论
- ✅ 结合用户具体情况

---

## 风险与限制

### 风险
- ❌ 数据隐私泄露（需本地分析）
- ❌ 误诊心理问题（需免责声明）
- ❌ 过度解读（需保持谨慎）

### 限制
- ⚠️ 不是专业心理咨询师
- ⚠️ 严重问题建议转介
- ⚠️ 基于文本，可能不完整

---

## 下一步行动

1. **确认方案**: 你同意这个方向吗？
2. **创建Agent**: 创建 `psychological-counselor.prompt.md`
3. **测试**: 用王佳楼案例测试
4. **记录教训**: 更新 `dynamic_rules.md`

---

**等待你的反馈和补充**（特别是那份研究报告的详细内容）
