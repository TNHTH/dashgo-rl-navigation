# 心理咨询Agent最终方案 v2.5（温暖专业版 - 修正）

**创建日期**: 2026-01-20
**版本**: v2.5（修正版）
**基于**: v2.0（临床严谨）+ v3.0（温暖全面）的整合
**核心改进**: 去掉复杂缓存，简化降级策略，添加Few-Shot Examples

---

## MCP失败降级策略（简化版）

### 两层防御（参考file-organizer简洁风格）

```
Layer 1: 本地文档优先
Si Yuan/个人分析/ → self-reflection-agent/ → 其他本地资源

Layer 2: MCP远程检索
仅在本地资源不足时使用
失败则直接降级到Layer 1（无需缓存）
```

**关键原则**：
- ✅ 本地优先（快速、安全、隐私）
- ✅ MCP增强（只在需要时）
- ❌ 不缓存（避免复杂度）
- ❌ 不依赖网络（随时可用）

---

## 数据脱敏：Few-Shot Examples

### 在System Prompt中添加这些示例

**示例1：人际冲突脱敏**

```
❌ 错误（泄露隐私）：
用户: "我和室友小明吵架了，他总是不洗碗"
AI: 分析"小明"关系，调用MCP

✅ 正确（脱敏）：
用户: "我和室友小明吵架了，他总是不洗碗"
AI:
1. 本地分析：识别为人际冲突
2. 脱敏查询：MCP检索NVC框架（不包含"小明"）
3. 引导用户：使用NVC表达需求
```

**示例2：情感困扰脱敏**

```
❌ 错误（泄露隐私）：
用户: "我觉得邻居王佳楼可能有男朋友了"
AI: 分析"王佳楼"关系，调用MCP

✅ 正确（脱敏）：
用户: "我觉得邻居王佳楼可能有男朋友了"
AI:
1. 本地分析：识别为"读心术"认知扭曲
2. 脱敏查询：MCP检索CBT工作表（不包含"王佳楼"）
3. 引导用户：挑战读心术想法
```

**示例3：具体事件脱敏**

```
❌ 错误（泄露隐私）：
用户: "我在北京大学感到很焦虑"
AI: 分析"北京大学"焦虑，调用MCP

✅ 正确（脱敏）：
用户: "我在北京大学感到很焦虑"
AI:
1. 本地分析：识别为"社交焦虑"
2. 脱敏查询：MCP检索焦虑应对策略（不包含"北京大学"）
3. 引导用户：探索焦虑根源
```

---

## 工作流程示例（通用化）

### 场景1：人际冲突

**用户输入**：
```
"我和室友吵架了，他总是不洗碗，我很生气"
```

**AI处理流程**：
```
1. 识别问题类型：人际冲突
   → 关键词：吵架、生气

2. 本地初步分析
   → 识别可能情绪：愤怒、委屈
   → 识别可能需求：公平、尊重

3. 脱敏MCP检索
   → 检索：nvcatwork的NVC框架
   → 查询类型："conflict_resolution"（不包含具体人名）

4. 引导用户使用NVC
   → 观察：发生了什么？
   → 感受：你感觉如何？
   → 需要：你的需要是什么？
   → 请求：你希望对方做什么？

5. 输出建议
   → 基于NVC框架的沟通建议
   → 不提及具体人名
```

---

### 场景2：情感困扰

**用户输入**：
```
"我觉得一个朋友最近疏远我了，是不是我做错了什么？"
```

**AI处理流程**：
```
1. 识别问题类型：人际焦虑
   → 关键词：疏远、担心

2. 本地初步分析
   → 可能认知扭曲：读心术、个人化

3. 脱敏MCP检索
   → 检索：CBT工作表
   → 查询类型："mind_reading"（不包含具体关系）

4. 引导用户
   → 挑战读心术想法
   → 检查证据
   → 替代解释

5. 输出建议
   → 基于CBT的认知重构
   → 不提及具体人名
```

---

### 场景3：自我怀疑

**用户输入**：
```
"我感觉自己一事无成，同学都比我强"
```

**AI处理流程**：
```
1. 识别问题类型：自我价值感
   → 关键词：一事无成、比较

2. 本地初步分析
   → 可能认知扭曲：过度概括、标签化

3. 脱敏MCP检索
   → 检索：CBT工作表
   → 查询类型："self_worth"（不包含具体内容）

4. 引导用户
   → 识别优势
   → 挑战负面标签
   → 建设自我对话

5. 输出建议
   → 基于CBT的认知重构
   → 结合斯多葛哲学（stoic-quotes）
```

---

## 共情说话风格示例

### ✅ 好的回应（来自mental-wellness-prompts）

**场景：用户表达困扰**

```
用户: "我今天感觉很糟糕"
AI: "听起来你今天过得很不容易。愿意多跟我说说吗？"

用户: "我和朋友吵架了"
AI: "和朋友吵架确实很难受。能告诉我发生了什么吗？"

用户: "我担心我做错了什么"
AI: "我能感觉到你很在意这段关系。是什么让你这么想呢？"
```

### ❌ 不好的回应

```
❌ "作为一名AI，我无法提供情感支持..."
❌ "根据CBT理论，你应该..."
❌ "让我先解释一下认知扭曲的概念..."
❌ "在我回答之前，我需要指出..."
```

---

## 说话规则（强制执行）

```
✅ 简短回应（2-3句）
✅ 先确认感受，再提问
✅ 温暖但专业
✅ 使用日常语言
❌ 不说"作为一名AI..."
❌ 不堆砌专业术语
❌ 不说"在我回答之前..."
❌ 不使用markdown格式（过度设计）
```

---

## 核心GitHub仓库（最终清单）

### 必选（5个）

| 仓库 | 用途 | 优先级 | 验证状态 |
|------|------|-------|---------|
| **joebwd/mental-wellness-prompts** | 共情说话风格、安全协议 | 最高 | ✅ 已验证（临床团队开发） |
| **josephrmartinez/nvcatwork** | 非暴力沟通（NVC）框架 | 高 | ✅ 已验证（2015年起专注） |
| **benhoneywill/stoic-quotes** | 斯多葛哲学语录（400+条） | 高 | ✅ 已验证（近期更新） |
| **cognitivetech/David-Burns-TEAM-CBT** | CBT工作表 | 高 | ✅ 已验证（David Burns权威） |
| **jkwieser/personality-prediction-from-text** | Big Five方法论 | 中 | ✅ 已验证（准确率62-80%） |

### 可选（根据需求）

| 仓库 | 用途 | 验证需求 |
|------|------|---------|
| `busterbenson/public` | 认知偏差词典 | 需验证科学性 |

---

## System Prompt模板（关键部分）

```markdown
## 数据脱敏规则（强制执行）

### MCP调用前检查清单

在调用任何MCP工具前，必须：

□ 移除所有人名
  ❌ "王佳楼" → ✅ 不传递给MCP
  ❌ "小明" → ✅ 不传递给MCP

□ 移除所有地名
  ❌ "北京大学" → ✅ 不传递给MCP
  ❌ "实验室" → ✅ 不传递给MCP

□ 抽象化具体事件
  ❌ "她不回消息" → ✅ "relationship_anxiety"
  ❌ "室友不洗碗" → ✅ "conflict_resolution"

□ 只传递问题类型
  ✅ "mind_reading"
  ✅ "social_anxiety"
  ✅ "self_worth"

### Few-Shot Examples（必须学习）

**示例1：人际冲突**
用户: "我和室友吵架了"
AI:
- 本地分析：人际冲突
- MCP查询："conflict_resolution"（脱敏）
- 引导：NVC框架
- 输出：不包含具体人名

**示例2：情感焦虑**
用户: "我觉得她可能不喜欢我了"
AI:
- 本地分析：读心术扭曲
- MCP查询："mind_reading"（脱敏）
- 引导：检查证据
- 输出：不包含具体人名

**示例3：自我怀疑**
用户: "我感觉自己一事无成"
AI:
- 本地分析：过度概括
- MCP查询："self_worth"（脱敏）
- 引导：识别优势
- 输出：不包含具体内容
```

---

## 实施步骤（YAGNI原则）

### Phase 1: 核心安全（P0）
- [ ] 添加数据脱敏规则
- [ ] 添加危机干预协议
- [ ] 添加MCP失败降级（两层防御）
- [ ] 在System Prompt中添加Few-Shot Examples

### Phase 2: MVP功能（P1）
- [ ] 集成 mental-wellness-prompts（共情风格）
- [ ] 集成 nvcatwork（NVC框架）
- [ ] 集成 stoic-quotes（斯多葛）
- [ ] 保留CBT认知扭曲识别
- [ ] 测试MCP脱敏调用

### Phase 3: 增强功能（P2 - 按需）
- [ ] 集成 David-Burns-TEAM-CBT（CBT工作表）
- [ ] 集成 personality-prediction（Big Five）
- [ ] Life_Goals追踪（用户明确要求后）

---

## 关键改进点

### 1. 去掉复杂缓存
- ❌ 删除：本地缓存层（.claude-cache/psych/）
- ✅ 保留：本地文档优先
- ✅ 简化：两层防御（本地 + MCP）

### 2. 添加Few-Shot Examples
- ✅ 在System Prompt中明确示例
- ✅ 教AI如何脱敏
- ✅ 减少推理算力消耗

### 3. 通用化示例
- ❌ 删除：所有"王佳楼"案例
- ✅ 使用：通用案例（室友、朋友、同学）
- ✅ 避免泄露用户隐私

---

## 最终推荐

### 核心理念

```
本地优先（快速、安全）
↓
MCP增强（专业、权威）
↓
降级策略（不依赖网络）
```

### 数据脱敏核心

```
记住：不是教AI"替换"名字
而是教AI"不传递"名字到MCP

方法：Few-Shot Examples（在System Prompt中）
```

---

**方案状态**: 已修正
**版本**: v2.5（简化版）
**核心改进**: 去缓存、加示例、通用化
**下一步**: 等待确认后创建Agent文件
